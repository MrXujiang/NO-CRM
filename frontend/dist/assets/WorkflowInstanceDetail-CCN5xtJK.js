import{d as L,j as O,u as P,r as g,k as x,l as q,b as d,c as p,e as f,h as s,w as e,i as l,t as i,p as r,o as a,F as A,f as j,m as C,M as G,_ as H}from"./index-BQBF81MK.js";import{w as Q}from"./workflow-C3Hchb8L.js";const U={class:"instance-detail-page"},X={class:"page-header"},Y={key:0,class:"detail-content"},Z={key:3},$={class:"log-item"},ee={class:"log-title"},te={class:"log-content"},se={key:0,class:"log-opinion"},ae={key:1,class:"log-duration"},ne={key:1,class:"loading-state"},le=L({__name:"WorkflowInstanceDetail",setup(oe){const D=O(),K=P(),n=g(null),y=g([]),b=g([]),T=[{colKey:"nodeName",title:"节点",width:120},{colKey:"assigneeName",title:"处理人",width:100},{colKey:"status",title:"状态",width:100,cell:"status"},{colKey:"opinion",title:"意见",ellipsis:!0},{colKey:"createdAt",title:"创建时间",width:160},{colKey:"processedAt",title:"处理时间",width:160}],B=x(()=>y.value.length-1),I=x(()=>n.value?n.value.status==="completed"?"finish":n.value.status==="rejected"?"error":"process":"process"),h=_=>({start:"发起",approve:"通过",reject:"驳回",transfer:"转交",cancel:"取消",timeout:"超时"})[_]||_,S=_=>({start:"primary",approve:"success",reject:"danger",transfer:"warning",cancel:"default",timeout:"danger"})[_]||"default",w=async()=>{var t,v;const _=D.params.id;if(_)try{const m=await Q.getInstanceDetail(_);n.value=m.instance,y.value=m.logs,b.value=m.tasks}catch(m){G.error(((v=(t=m.response)==null?void 0:t.data)==null?void 0:v.message)||"加载失败")}},V=()=>{K.back()};return q(()=>{w()}),(_,t)=>{const v=d("t-icon"),m=d("t-button"),N=d("t-space"),c=d("t-descriptions-item"),u=d("t-tag"),z=d("t-descriptions"),k=d("t-card"),M=d("t-step-item"),F=d("t-steps"),R=d("t-table"),W=d("t-timeline-item"),E=d("t-timeline"),J=d("t-loading");return a(),p("div",U,[f("div",X,[s(N,null,{default:e(()=>[s(m,{theme:"default",onClick:V},{icon:e(()=>[s(v,{name:"arrow-left"})]),default:e(()=>[t[0]||(t[0]=l(" 返回 ",-1))]),_:1}),t[1]||(t[1]=f("h2",null,"流程详情",-1))]),_:1}),s(N,null,{default:e(()=>[s(m,{theme:"default",onClick:w},{icon:e(()=>[s(v,{name:"refresh"})]),default:e(()=>[t[2]||(t[2]=l(" 刷新 ",-1))]),_:1})]),_:1})]),n.value?(a(),p("div",Y,[s(k,{title:"基本信息",class:"info-card"},{default:e(()=>[s(z,{column:3,bordered:""},{default:e(()=>[s(c,{label:"工作流名称"},{default:e(()=>[l(i(n.value.workflowName),1)]),_:1}),s(c,{label:"业务类型"},{default:e(()=>[n.value.businessType==="order"?(a(),r(u,{key:0,theme:"primary"},{default:e(()=>[...t[3]||(t[3]=[l("订单",-1)])]),_:1})):n.value.businessType==="contract"?(a(),r(u,{key:1,theme:"success"},{default:e(()=>[...t[4]||(t[4]=[l("合同",-1)])]),_:1})):(a(),r(u,{key:2},{default:e(()=>[l(i(n.value.businessType),1)]),_:1}))]),_:1}),s(c,{label:"当前节点"},{default:e(()=>[s(u,{theme:"warning"},{default:e(()=>[l(i(n.value.currentNodeName),1)]),_:1})]),_:1}),s(c,{label:"流程状态"},{default:e(()=>[n.value.status==="running"?(a(),r(u,{key:0,theme:"primary"},{default:e(()=>[...t[5]||(t[5]=[l("运行中",-1)])]),_:1})):n.value.status==="pending"?(a(),r(u,{key:1,theme:"warning"},{default:e(()=>[...t[6]||(t[6]=[l("等待处理",-1)])]),_:1})):n.value.status==="completed"?(a(),r(u,{key:2,theme:"success"},{default:e(()=>[...t[7]||(t[7]=[l("已完成",-1)])]),_:1})):n.value.status==="rejected"?(a(),r(u,{key:3,theme:"danger"},{default:e(()=>[...t[8]||(t[8]=[l("已驳回",-1)])]),_:1})):(a(),r(u,{key:4,theme:"default"},{default:e(()=>[l(i(n.value.status),1)]),_:1}))]),_:1}),s(c,{label:"审批结果"},{default:e(()=>[n.value.result==="approved"?(a(),r(u,{key:0,theme:"success"},{default:e(()=>[...t[9]||(t[9]=[l("通过",-1)])]),_:1})):n.value.result==="rejected"?(a(),r(u,{key:1,theme:"danger"},{default:e(()=>[...t[10]||(t[10]=[l("驳回",-1)])]),_:1})):n.value.result==="cancelled"?(a(),r(u,{key:2,theme:"default"},{default:e(()=>[...t[11]||(t[11]=[l("取消",-1)])]),_:1})):(a(),p("span",Z,"-"))]),_:1}),s(c,{label:"发起人"},{default:e(()=>[l(i(n.value.initiatorName),1)]),_:1}),s(c,{label:"开始时间"},{default:e(()=>[l(i(n.value.startedAt),1)]),_:1}),s(c,{label:"完成时间"},{default:e(()=>[l(i(n.value.finishedAt||"-"),1)]),_:1}),s(c,{label:"耗时"},{default:e(()=>[l(i(n.value.duration?n.value.duration+"分钟":"-"),1)]),_:1})]),_:1})]),_:1}),s(k,{title:"业务数据",class:"business-card"},{default:e(()=>[f("pre",null,i(JSON.stringify(n.value.businessData,null,2)),1)]),_:1}),s(k,{title:"流程进度",class:"progress-card"},{default:e(()=>[s(F,{current:B.value,status:I.value},{default:e(()=>[(a(!0),p(A,null,j(y.value,(o,ue)=>(a(),r(M,{key:o.id,title:o.nodeName,content:o.operatorName+" • "+h(o.action)},null,8,["title","content"]))),128))]),_:1},8,["current","status"])]),_:1}),s(k,{title:"处理任务",class:"tasks-card"},{default:e(()=>[s(R,{data:b.value,columns:T,size:"small"},{status:e(({row:o})=>[o.status==="pending"?(a(),r(u,{key:0,theme:"warning"},{default:e(()=>[...t[12]||(t[12]=[l("待处理",-1)])]),_:1})):o.status==="approved"?(a(),r(u,{key:1,theme:"success"},{default:e(()=>[...t[13]||(t[13]=[l("已通过",-1)])]),_:1})):o.status==="rejected"?(a(),r(u,{key:2,theme:"danger"},{default:e(()=>[...t[14]||(t[14]=[l("已驳回",-1)])]),_:1})):(a(),r(u,{key:3},{default:e(()=>[l(i(o.status),1)]),_:2},1024))]),_:1},8,["data"])]),_:1}),s(k,{title:"操作日志",class:"logs-card"},{default:e(()=>[s(E,null,{default:e(()=>[(a(!0),p(A,null,j(y.value,o=>(a(),r(W,{key:o.id,label:o.createdAt},{default:e(()=>[f("div",$,[f("div",ee,[f("strong",null,i(o.nodeName),1),s(u,{size:"small",theme:S(o.action)},{default:e(()=>[l(i(h(o.action)),1)]),_:2},1032,["theme"])]),f("div",te," 操作人："+i(o.operatorName),1),o.opinion?(a(),p("div",se," 意见："+i(o.opinion),1)):C("",!0),o.duration?(a(),p("div",ae," 耗时："+i(o.duration)+"分钟 ",1)):C("",!0)])]),_:2},1032,["label"]))),128))]),_:1})]),_:1})])):(a(),p("div",ne,[s(J,{size:"large",text:"加载中..."})]))])}}}),de=H(le,[["__scopeId","data-v-196f7b42"]]);export{de as default};
