import{i as u,L as b,R as F}from"./index-CGdFOYoS.js";import{s as G}from"./statistics-5qbaCSeu.js";import{d as U,r as c,l as X,B as $,b as R,c as _,e as t,h as w,t as B,w as z,i as j,F as q,f as I,M as W,n as D,o as S,_ as H}from"./index-BQBF81MK.js";const J={class:"dashboard-container"},K={class:"dashboard-header"},Q={class:"refresh-info"},Y={class:"stats-cards"},Z={class:"stat-content"},ee={class:"stat-value"},te={class:"stat-label"},ae={class:"charts-container"},se={class:"chart-row"},oe={class:"chart-card chart-large"},re={class:"chart-card"},le={class:"chart-row"},ie={class:"chart-card"},ne={class:"chart-card"},ce={class:"chart-card"},de=U({__name:"Dashboard",setup(ue){const v=c(!1),x=c(""),s=c(null),y=c(),p=c(),m=c(),h=c(),g=c();let o=null,r=null,l=null,i=null,n=null;const d=c([{icon:"user",label:"客户总数",value:0,color:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{icon:"chart-line",label:"线索总数",value:0,color:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{icon:"time",label:"跟进记录",value:0,color:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{icon:"bulletpoint",label:"任务总数",value:0,color:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"}]),O={uncontacted:"未跟进",contacted:"跟进中",qualified:"已合格",converted:"已成交",invalid:"无效"},C={low:"低",medium:"中",high:"高"},P={todo:"待办",completed:"已完成"},E={call:"电话",email:"邮件",meeting:"会议",other:"其他"},k=async()=>{v.value=!0;try{const e=await G.getOverview();if(!e||typeof e!="object")throw new Error("返回数据格式错误");s.value={totalCustomers:e.totalCustomers||0,totalLeads:e.totalLeads||0,totalActivities:e.totalActivities||0,totalTasks:e.totalTasks||0,leadsByStage:Array.isArray(e.leadsByStage)?e.leadsByStage:[],tasksByPriority:Array.isArray(e.tasksByPriority)?e.tasksByPriority:[],tasksByStatus:Array.isArray(e.tasksByStatus)?e.tasksByStatus:[],activitiesByType:Array.isArray(e.activitiesByType)?e.activitiesByType:[],recentTrend:Array.isArray(e.recentTrend)?e.recentTrend:[]},d.value[0].value=s.value.totalCustomers,d.value[1].value=s.value.totalLeads,d.value[2].value=s.value.totalActivities,d.value[3].value=s.value.totalTasks,x.value=new Date().toLocaleString("zh-CN"),N()}catch(e){console.error("加载数据失败:",e),console.error("错误堆栈:",e.stack),W.error(`数据获取失败：${e.message||"未知错误"}`)}finally{v.value=!1}},M=()=>{k()},N=()=>{if(!s.value){console.warn("statsData 为空，跳过图表初始化");return}try{if(y.value&&(o&&o.dispose(),o=u(y.value),o.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["客户","线索"],top:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:(s.value.recentTrend||[]).map(e=>e.date),axisLine:{lineStyle:{color:"#999"}}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#999"}},splitLine:{lineStyle:{color:"#f0f0f0"}}},series:[{name:"客户",type:"line",smooth:!0,data:(s.value.recentTrend||[]).map(e=>e.customers),itemStyle:{color:"#667eea"},areaStyle:{color:new b(0,0,0,1,[{offset:0,color:"rgba(102, 126, 234, 0.3)"},{offset:1,color:"rgba(102, 126, 234, 0.05)"}])}},{name:"线索",type:"line",smooth:!0,data:(s.value.recentTrend||[]).map(e=>e.leads),itemStyle:{color:"#f5576c"},areaStyle:{color:new b(0,0,0,1,[{offset:0,color:"rgba(245, 87, 108, 0.3)"},{offset:1,color:"rgba(245, 87, 108, 0.05)"}])}}]})),p.value&&(r&&r.dispose(),r=u(p.value),r.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{type:"pie",radius:["40%","70%"],center:["40%","50%"],data:(s.value.leadsByStage||[]).map(e=>({name:O[e.stage]||e.stage,value:e.count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:`{b}
{d}%`}}],color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de"]})),m.value&&(l&&l.dispose(),l=u(m.value),l.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:(s.value.tasksByPriority||[]).map(e=>C[e.priority]||e.priority),axisLine:{lineStyle:{color:"#999"}}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#999"}},splitLine:{lineStyle:{color:"#f0f0f0"}}},series:[{type:"bar",data:(s.value.tasksByPriority||[]).map(e=>({value:e.count,itemStyle:{color:new b(0,0,0,1,[{offset:0,color:"#4facfe"},{offset:1,color:"#00f2fe"}])}})),barWidth:"60%"}]})),h.value&&(i&&i.dispose(),i=u(h.value),i.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{bottom:10,left:"center"},series:[{type:"pie",radius:["50%","70%"],center:["50%","45%"],data:(s.value.tasksByStatus||[]).map(e=>({name:P[e.status]||e.status,value:e.count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],color:["#fac858","#91cc75"]})),g.value){n&&n.dispose(),n=u(g.value);const e=Math.max(...(s.value.activitiesByType||[]).map(a=>a.count),1);n.setOption({tooltip:{trigger:"item"},radar:{indicator:(s.value.activitiesByType||[]).map(a=>({name:E[a.type]||a.type,max:e})),radius:"60%",center:["50%","50%"]},series:[{type:"radar",data:[{value:(s.value.activitiesByType||[]).map(a=>a.count),name:"跟进方式",areaStyle:{color:new F(.5,.5,1,[{offset:0,color:"rgba(67, 233, 123, 0.3)"},{offset:1,color:"rgba(56, 249, 215, 0.1)"}])},lineStyle:{color:"#43e97b"}}]}]})}}catch(e){console.error("初始化图表失败:",e)}},L=()=>{o==null||o.resize(),r==null||r.resize(),l==null||l.resize(),i==null||i.resize(),n==null||n.resize()};return X(()=>{k(),window.addEventListener("resize",L)}),$(()=>{window.removeEventListener("resize",L),o==null||o.dispose(),r==null||r.dispose(),l==null||l.dispose(),i==null||i.dispose(),n==null||n.dispose()}),(e,a)=>{const A=R("t-icon"),V=R("t-button");return S(),_("div",J,[t("div",K,[a[1]||(a[1]=t("h1",null,"数据大屏",-1)),t("div",Q,[t("span",null,"最后更新："+B(x.value),1),w(V,{theme:"primary",size:"small",onClick:M,loading:v.value},{icon:z(()=>[w(A,{name:"refresh"})]),default:z(()=>[a[0]||(a[0]=j(" 刷新数据 ",-1))]),_:1},8,["loading"])])]),t("div",Y,[(S(!0),_(q,null,I(d.value,(f,T)=>(S(),_("div",{class:"stat-card",key:T,style:D({animationDelay:`${T*.1}s`})},[t("div",{class:"stat-icon",style:D({background:f.color})},[w(A,{name:f.icon,size:"28px"},null,8,["name"])],4),t("div",Z,[t("div",ee,B(f.value),1),t("div",te,B(f.label),1)])],4))),128))]),t("div",ae,[t("div",se,[t("div",oe,[a[2]||(a[2]=t("div",{class:"chart-header"},[t("h3",null,"最近7天数据趋势")],-1)),t("div",{ref_key:"trendChartRef",ref:y,class:"chart-content"},null,512)]),t("div",re,[a[3]||(a[3]=t("div",{class:"chart-header"},[t("h3",null,"线索阶段分布")],-1)),t("div",{ref_key:"leadStageChartRef",ref:p,class:"chart-content"},null,512)])]),t("div",le,[t("div",ie,[a[4]||(a[4]=t("div",{class:"chart-header"},[t("h3",null,"任务优先级分布")],-1)),t("div",{ref_key:"taskPriorityChartRef",ref:m,class:"chart-content"},null,512)]),t("div",ne,[a[5]||(a[5]=t("div",{class:"chart-header"},[t("h3",null,"任务状态")],-1)),t("div",{ref_key:"taskStatusChartRef",ref:h,class:"chart-content"},null,512)]),t("div",ce,[a[6]||(a[6]=t("div",{class:"chart-header"},[t("h3",null,"跟进方式分布")],-1)),t("div",{ref_key:"activityTypeChartRef",ref:g,class:"chart-content"},null,512)])])])])}}}),pe=H(de,[["__scopeId","data-v-b1bb5aa8"]]);export{pe as default};
