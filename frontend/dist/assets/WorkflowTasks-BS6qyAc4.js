import{d as Q,u as X,r as g,D as Y,l as Z,b as r,c as $,e as x,h as l,w as t,i as n,p as u,m as k,o as s,t as f,M as j,_ as ee}from"./index-BQBF81MK.js";import{w as A}from"./workflow-C3Hchb8L.js";const te={class:"workflow-tasks-page"},ae={class:"page-header"},ne={key:0},le={style:{"margin-top":"20px"}},se={key:0,style:{"margin-top":"24px","padding-top":"24px","border-top":"1px solid #e7e7e7"}},oe=Q({__name:"WorkflowTasks",setup(ue){const P=X(),V=g(!1),M=g([]),_=g("pending"),b=g(!1),o=g(null),c=g(""),T=g(0),v=Y({current:1,pageSize:10,total:0}),I=[{colKey:"workflowName",title:"工作流名称",width:150},{colKey:"businessType",title:"业务类型",width:100,cell:"businessType"},{colKey:"businessTitle",title:"业务标题",width:200},{colKey:"nodeName",title:"当前节点",width:120},{colKey:"status",title:"状态",width:100,cell:"status"},{colKey:"priority",title:"优先级",width:80,cell:"priority"},{colKey:"createdAt",title:"创建时间",width:150},{colKey:"action",title:"操作",width:220,cell:"action",fixed:"right"}],w=async()=>{var i,e;V.value=!0;try{const m=_.value==="pending"?"pending":_.value,p=await A.getMyTasks(v.current,v.pageSize,m);M.value=p.data,v.total=p.total,_.value==="pending"&&(T.value=p.total)}catch(m){j.error(((e=(i=m.response)==null?void 0:i.data)==null?void 0:e.message)||"加载数据失败")}finally{V.value=!1}},U=async()=>{try{const i=await A.getMyTasks(1,1,"pending");T.value=i.total}catch(i){console.error("加载待办数量失败",i)}},h=()=>{v.current=1,w()},W=()=>{w()},E=i=>{o.value=i,c.value=i.opinion||"",b.value=!0},B=(i,e)=>{o.value=i,c.value="",K(i,e?"approve":"reject")},K=async(i,e)=>{var m,p;try{await A.processTask(i.id,{action:e,opinion:c.value}),j.success(e==="approve"?"已通过":"已驳回"),b.value=!1,c.value="",w(),U()}catch(C){j.error(((p=(m=C.response)==null?void 0:m.data)==null?void 0:p.message)||"操作失败")}},O=i=>{b.value=!1,P.push(`/workflow-instances/${i}`)};return Z(()=>{w(),U()}),(i,e)=>{const m=r("t-icon"),p=r("t-button"),C=r("t-badge"),N=r("t-space"),S=r("t-tab-panel"),R=r("t-tabs"),q=r("t-card"),d=r("t-tag"),z=r("t-link"),F=r("t-table"),G=r("t-pagination"),y=r("t-descriptions-item"),H=r("t-descriptions"),J=r("t-textarea"),L=r("t-dialog");return s(),$("div",te,[x("div",ae,[e[9]||(e[9]=x("h2",null,"我的待办",-1)),l(N,null,{default:t(()=>[l(C,{count:T.value,"max-count":99},{default:t(()=>[l(p,{theme:"primary",onClick:w},{icon:t(()=>[l(m,{name:"refresh"})]),default:t(()=>[e[8]||(e[8]=n(" 刷新 ",-1))]),_:1})]),_:1},8,["count"])]),_:1})]),l(q,{class:"filter-card"},{default:t(()=>[l(R,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),onChange:h},{default:t(()=>[l(S,{value:"pending"},{label:t(()=>[l(C,{count:T.value,"max-count":99,offset:[10,0]},{default:t(()=>[...e[10]||(e[10]=[n(" 待处理 ",-1)])]),_:1},8,["count"])]),_:1}),l(S,{value:"approved",label:"已通过"}),l(S,{value:"rejected",label:"已驳回"})]),_:1},8,["modelValue"])]),_:1}),l(F,{data:M.value,columns:I,loading:V.value,"row-key":"id",stripe:"",hover:"",class:"data-table"},{businessType:t(({row:a})=>[a.businessType==="order"?(s(),u(d,{key:0,theme:"primary"},{default:t(()=>[...e[11]||(e[11]=[n("订单",-1)])]),_:1})):a.businessType==="contract"?(s(),u(d,{key:1,theme:"success"},{default:t(()=>[...e[12]||(e[12]=[n("合同",-1)])]),_:1})):a.businessType==="customer"?(s(),u(d,{key:2,theme:"warning"},{default:t(()=>[...e[13]||(e[13]=[n("客户",-1)])]),_:1})):(s(),u(d,{key:3},{default:t(()=>[n(f(a.businessType),1)]),_:2},1024))]),status:t(({row:a})=>[a.status==="pending"?(s(),u(d,{key:0,theme:"warning"},{default:t(()=>[...e[14]||(e[14]=[n("待处理",-1)])]),_:1})):a.status==="approved"?(s(),u(d,{key:1,theme:"success"},{default:t(()=>[...e[15]||(e[15]=[n("已通过",-1)])]),_:1})):a.status==="rejected"?(s(),u(d,{key:2,theme:"danger"},{default:t(()=>[...e[16]||(e[16]=[n("已驳回",-1)])]),_:1})):(s(),u(d,{key:3},{default:t(()=>[n(f(a.status),1)]),_:2},1024))]),priority:t(({row:a})=>[a.priority==="high"?(s(),u(d,{key:0,theme:"danger"},{default:t(()=>[...e[17]||(e[17]=[n("高",-1)])]),_:1})):a.priority==="medium"?(s(),u(d,{key:1,theme:"warning"},{default:t(()=>[...e[18]||(e[18]=[n("中",-1)])]),_:1})):(s(),u(d,{key:2,theme:"default"},{default:t(()=>[...e[19]||(e[19]=[n("低",-1)])]),_:1}))]),action:t(({row:a})=>[l(N,null,{default:t(()=>[l(z,{theme:"primary",onClick:D=>E(a)},{default:t(()=>[...e[20]||(e[20]=[n("查看详情",-1)])]),_:1},8,["onClick"]),a.status==="pending"?(s(),u(z,{key:0,theme:"success",onClick:D=>B(a,!0)},{default:t(()=>[...e[21]||(e[21]=[n(" 通过 ",-1)])]),_:1},8,["onClick"])):k("",!0),a.status==="pending"?(s(),u(z,{key:1,theme:"danger",onClick:D=>B(a,!1)},{default:t(()=>[...e[22]||(e[22]=[n(" 驳回 ",-1)])]),_:1},8,["onClick"])):k("",!0)]),_:2},1024)]),_:1},8,["data","loading"]),l(G,{modelValue:v.current,"onUpdate:modelValue":e[1]||(e[1]=a=>v.current=a),pageSize:v.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>v.pageSize=a),total:v.total,"show-jumper":"",onChange:W},null,8,["modelValue","pageSize","total"]),l(L,{visible:b.value,"onUpdate:visible":e[7]||(e[7]=a=>b.value=a),header:"任务详情",width:"800px",footer:!1},{default:t(()=>[o.value?(s(),$("div",ne,[l(H,{column:2,bordered:""},{default:t(()=>[l(y,{label:"工作流"},{default:t(()=>[n(f(o.value.workflowName),1)]),_:1}),l(y,{label:"当前节点"},{default:t(()=>[n(f(o.value.nodeName),1)]),_:1}),l(y,{label:"业务类型"},{default:t(()=>[o.value.businessType==="order"?(s(),u(d,{key:0,theme:"primary"},{default:t(()=>[...e[23]||(e[23]=[n("订单",-1)])]),_:1})):o.value.businessType==="contract"?(s(),u(d,{key:1,theme:"success"},{default:t(()=>[...e[24]||(e[24]=[n("合同",-1)])]),_:1})):(s(),u(d,{key:2},{default:t(()=>[n(f(o.value.businessType),1)]),_:1}))]),_:1}),l(y,{label:"业务标题"},{default:t(()=>[n(f(o.value.businessTitle),1)]),_:1}),l(y,{label:"创建时间",span:2},{default:t(()=>[n(f(o.value.createdAt),1)]),_:1}),l(y,{label:"任务状态",span:2},{default:t(()=>[o.value.status==="pending"?(s(),u(d,{key:0,theme:"warning"},{default:t(()=>[...e[25]||(e[25]=[n("待处理",-1)])]),_:1})):o.value.status==="approved"?(s(),u(d,{key:1,theme:"success"},{default:t(()=>[...e[26]||(e[26]=[n("已通过",-1)])]),_:1})):o.value.status==="rejected"?(s(),u(d,{key:2,theme:"danger"},{default:t(()=>[...e[27]||(e[27]=[n("已驳回",-1)])]),_:1})):k("",!0)]),_:1}),o.value.processedAt?(s(),u(y,{key:0,label:"处理时间",span:2},{default:t(()=>[n(f(o.value.processedAt),1)]),_:1})):k("",!0),o.value.opinion?(s(),u(y,{key:1,label:"审批意见",span:2},{default:t(()=>[n(f(o.value.opinion),1)]),_:1})):k("",!0)]),_:1}),x("div",le,[l(p,{theme:"default",onClick:e[3]||(e[3]=a=>O(o.value.instanceId))},{default:t(()=>[...e[28]||(e[28]=[n(" 查看完整流程 ",-1)])]),_:1})]),o.value.status==="pending"?(s(),$("div",se,[e[31]||(e[31]=x("h4",null,"处理任务",-1)),l(J,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),placeholder:"请输入处理意见（可选）",maxlength:500,style:{"margin-top":"12px"}},null,8,["modelValue"]),l(N,{style:{"margin-top":"16px"}},{default:t(()=>[l(p,{theme:"success",onClick:e[5]||(e[5]=a=>K(o.value,"approve"))},{icon:t(()=>[l(m,{name:"check"})]),default:t(()=>[e[29]||(e[29]=n(" 通过 ",-1))]),_:1}),l(p,{theme:"danger",onClick:e[6]||(e[6]=a=>K(o.value,"reject"))},{icon:t(()=>[l(m,{name:"close"})]),default:t(()=>[e[30]||(e[30]=n(" 驳回 ",-1))]),_:1})]),_:1})])):k("",!0)])):k("",!0)]),_:1},8,["visible"])])}}}),re=ee(oe,[["__scopeId","data-v-b92da9a4"]]);export{re as default};
