import{C as _,d as re,r as c,l as de,b as o,c as F,e as P,h as t,w as a,i as u,t as k,p as K,o as V,F as ue,f as ce,M as s,_ as me}from"./index-BQBF81MK.js";const f={getAll(r,v,m,g){const d={};return r&&(d.customerId=r),v&&(d.leadId=v),m&&(d.page=m),g&&(d.pageSize=g),_.get("/activities",{params:d})},getReminders(){return _.get("/activities/reminders")},create(r){return _.post("/activities",r)},update(r,v){return _.patch(`/activities/${r}`,v)},delete(r){return _.delete(`/activities/${r}`)},generateMock(r){return _.post("/activities/mock/generate",{count:r})},clearMock(){return _.delete("/activities/mock/clear")}},pe={class:"activities-page"},ve={class:"page-header"},_e={class:"pagination-container"},fe=re({__name:"Activities",setup(r){const v=c([]),m=c([]),g=c(!1),d=c(!1),S=c(!1),y=c(null),w=c(!1),z=c(10),p=c({current:1,pageSize:10,total:0}),i=c({type:"call",date:"",notes:"",remindDate:""}),j=[{colKey:"type",title:"跟进方式",width:100},{colKey:"date",title:"跟进时间",width:180,cell:(n,{row:e})=>M(e.date)},{colKey:"notes",title:"跟进内容",ellipsis:!0},{colKey:"remindDate",title:"提醒时间",width:180,cell:(n,{row:e})=>e.remindDate?M(e.remindDate):"-"},{colKey:"action",title:"操作",width:150,fixed:"right"}],R=n=>({call:"电话",email:"邮件",meeting:"会议",other:"其他"})[n]||n,G=n=>({call:"primary",email:"success",meeting:"warning",other:"default"})[n]||"default",h=async()=>{g.value=!0;try{const n=await f.getAll(void 0,void 0,p.value.current,p.value.pageSize);v.value=n.data,p.value.total=n.total}catch{s.error("加载跟进记录失败")}finally{g.value=!1}},I=()=>{h()},U=async()=>{try{m.value=await f.getReminders(),m.value.length>0?S.value=!0:s.info("暂无即将提醒的跟进")}catch{s.error("加载提醒失败")}},O=n=>{y.value=n,i.value={type:n.type,date:n.date,notes:n.notes,remindDate:n.remindDate||""},d.value=!0},q=async n=>{try{await f.delete(n),s.success("删除成功"),h()}catch{s.error("删除失败")}},H=async()=>{if(!i.value.date||!i.value.notes){s.warning("请填写必填信息");return}try{const n={...i.value,remindDate:i.value.remindDate||void 0};y.value?(await f.update(y.value.id,n),s.success("更新成功")):(await f.create(n),s.success("创建成功")),d.value=!1,h(),U()}catch{s.error(y.value?"更新失败":"创建失败")}},J=()=>{y.value=null,i.value={type:"call",date:"",notes:"",remindDate:""}},M=n=>new Date(n).toLocaleString("zh-CN"),Q=async()=>{try{const n=await f.generateMock(z.value);s.success(n.message),h()}catch{s.error("生成Mock数据失败")}},W=async()=>{try{const n=await f.clearMock();s.success(n.message),w.value=!1,h()}catch{s.error("清空数据失败")}},X=()=>{w.value=!1};return de(()=>{h(),U()}),(n,e)=>{const C=o("t-icon"),D=o("t-button"),A=o("t-space"),B=o("t-tag"),N=o("t-link"),T=o("t-popconfirm"),Y=o("t-table"),Z=o("t-pagination"),x=o("t-option"),ee=o("t-select"),b=o("t-form-item"),L=o("t-date-picker"),te=o("t-textarea"),E=o("t-form"),$=o("t-dialog"),ae=o("t-list-item-meta"),le=o("t-list-item"),ne=o("t-list"),oe=o("t-empty"),ie=o("t-input-number");return V(),F("div",pe,[P("div",ve,[t(A,null,{default:a(()=>[t(D,{theme:"primary",onClick:e[0]||(e[0]=l=>d.value=!0)},{icon:a(()=>[t(C,{name:"add"})]),default:a(()=>[e[12]||(e[12]=u(" 新建跟进记录 ",-1))]),_:1}),t(D,{theme:"default",onClick:U},{icon:a(()=>[t(C,{name:"notification"})]),default:a(()=>[u(" 即将提醒 ("+k(m.value.length)+") ",1)]),_:1}),t(D,{theme:"default",onClick:e[1]||(e[1]=l=>w.value=!0)},{icon:a(()=>[t(C,{name:"tools"})]),default:a(()=>[e[13]||(e[13]=u(" Mock数据 ",-1))]),_:1})]),_:1})]),t(Y,{data:v.value,columns:j,loading:g.value,"row-key":"id",stripe:"",hover:""},{type:a(({row:l})=>[t(B,{theme:G(l.type),variant:"light"},{default:a(()=>[u(k(R(l.type)),1)]),_:2},1032,["theme"])]),action:a(({row:l})=>[t(A,null,{default:a(()=>[t(N,{theme:"primary",onClick:se=>O(l)},{default:a(()=>[...e[14]||(e[14]=[u("编辑",-1)])]),_:1},8,["onClick"]),t(T,{content:"确定删除此记录吗？",onConfirm:se=>q(l.id)},{default:a(()=>[t(N,{theme:"danger"},{default:a(()=>[...e[15]||(e[15]=[u("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),P("div",_e,[t(Z,{modelValue:p.value.current,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value.current=l),pageSize:p.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>p.value.pageSize=l),total:p.value.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",onChange:I},null,8,["modelValue","pageSize","total"])]),t($,{visible:d.value,"onUpdate:visible":e[8]||(e[8]=l=>d.value=l),header:y.value?"编辑跟进记录":"新建跟进记录",width:"600px",onConfirm:H,onClose:J},{default:a(()=>[t(E,{data:i.value,"label-align":"right","label-width":100},{default:a(()=>[t(b,{label:"跟进方式",name:"type"},{default:a(()=>[t(ee,{modelValue:i.value.type,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.type=l),placeholder:"请选择跟进方式"},{default:a(()=>[t(x,{value:"call",label:"电话"}),t(x,{value:"email",label:"邮件"}),t(x,{value:"meeting",label:"会议"}),t(x,{value:"other",label:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"跟进时间",name:"date"},{default:a(()=>[t(L,{modelValue:i.value.date,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.date=l),"enable-time-picker":"",placeholder:"请选择跟进时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(b,{label:"跟进内容",name:"notes"},{default:a(()=>[t(te,{modelValue:i.value.notes,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.notes=l),placeholder:"请输入跟进内容",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),t(b,{label:"下次提醒",name:"remindDate"},{default:a(()=>[t(L,{modelValue:i.value.remindDate,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.remindDate=l),"enable-time-picker":"",placeholder:"设置下次跟进提醒时间（可选）",clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header"]),t($,{visible:S.value,"onUpdate:visible":e[9]||(e[9]=l=>S.value=l),header:"即将提醒的跟进",width:"700px",footer:!1},{default:a(()=>[m.value.length>0?(V(),K(ne,{key:0,split:!0},{default:a(()=>[(V(!0),F(ue,null,ce(m.value,l=>(V(),K(le,{key:l.id},{action:a(()=>[t(B,{theme:"warning"},{default:a(()=>[u(k(M(l.remindDate)),1)]),_:2},1024)]),default:a(()=>[t(ae,null,{title:a(()=>[u(k(R(l.type))+" - "+k(M(l.date)),1)]),description:a(()=>[u(k(l.notes),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(V(),K(oe,{key:1,description:"暂无即将提醒的跟进"}))]),_:1},8,["visible"]),t($,{visible:w.value,"onUpdate:visible":e[11]||(e[11]=l=>w.value=l),header:"Mock数据管理",width:"500px",onConfirm:X},{default:a(()=>[t(E,{"label-align":"right","label-width":100},{default:a(()=>[t(b,{label:"生成数量"},{default:a(()=>[t(ie,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=l=>z.value=l),min:1,max:100,placeholder:"请输入生成数量"},null,8,["modelValue"])]),_:1}),t(b,{label:"操作"},{default:a(()=>[t(A,null,{default:a(()=>[t(D,{theme:"primary",onClick:Q},{icon:a(()=>[t(C,{name:"add"})]),default:a(()=>[e[16]||(e[16]=u(" 生成Mock数据 ",-1))]),_:1}),t(T,{content:"确定清空所有跟进记录吗？此操作不可恢复！",onConfirm:W},{default:a(()=>[t(D,{theme:"danger"},{icon:a(()=>[t(C,{name:"delete"})]),default:a(()=>[e[17]||(e[17]=u(" 清空所有数据 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])])}}}),ye=me(fe,[["__scopeId","data-v-193e032b"]]);export{ye as default};
