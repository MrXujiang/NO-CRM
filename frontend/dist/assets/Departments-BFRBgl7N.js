import{d as V}from"./department-Cso6nBuK.js";import{d as re,r as y,D as ie,k as T,l as ue,b as r,c as w,e as m,h as l,w as t,i as d,p as b,o as c,m as $,t as v,F as me,f as ce,M as f,_ as pe}from"./index-BQBF81MK.js";const ve={class:"departments-page"},fe={class:"page-header"},_e={class:"department-container"},be={class:"department-tree"},ge={class:"tree-header"},ye={class:"tree-node-label"},ke={key:1,class:"empty-tree"},he={class:"department-detail"},Ce={key:0,class:"detail-content"},Ve={class:"detail-header"},we={class:"detail-info"},xe={key:0,class:"children-list"},De={key:1,class:"empty-detail"},Ie=re({__name:"Departments",setup(Me){const z=y(!1),x=y([]),s=y(null),D=y(!1),I=y(!1),_=y(null),M=y(null),i=ie({name:"",code:"",parentId:"",description:"",sort:0,status:"active"}),j={name:[{required:!0,message:"请输入部门名称"}],code:[{required:!0,message:"请输入部门编码"}]},q=[{colKey:"name",title:"部门名称",width:150},{colKey:"code",title:"编码",width:120},{colKey:"memberCount",title:"成员数",width:80,cell:"memberCount"},{colKey:"status",title:"状态",width:80,cell:"status"},{colKey:"action",title:"操作",width:120,cell:"action",fixed:"right"}],G=T(()=>{const a=[],e=(n,u=0)=>{n.forEach(p=>{a.push({...p,name:"  ".repeat(u)+p.name}),p.children&&p.children.length>0&&e(p.children,u+1)})};return e(x.value),a}),B=T(()=>x.value),k=async()=>{var a,e;z.value=!0;try{x.value=await V.getTree(),s.value&&(s.value=U(x.value,s.value.id))}catch(n){f.error(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"加载部门列表失败")}finally{z.value=!1}},U=(a,e)=>{for(const n of a){if(n.id===e)return n;if(n.children&&n.children.length>0){const u=U(n.children,e);if(u)return u}}return null},K=a=>{if(a.length>0){const e=a[0];s.value=U(x.value,e)}},N=a=>{_.value=null,M.value=a||null,Object.assign(i,{name:"",code:"",parentId:(a==null?void 0:a.id)||"",description:"",sort:0,status:"active"}),D.value=!0},S=a=>{_.value=a,M.value=null,Object.assign(i,{name:a.name,code:a.code,parentId:a.parentId||"",description:a.description||"",sort:a.sort,status:a.status}),D.value=!0},O=async()=>{var a,e;try{const n={...i,parentId:i.parentId||void 0};_.value?(await V.update(_.value.id,n),f.success("更新成功")):(await V.create(n),f.success("创建成功")),D.value=!1,k()}catch(n){f.error(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"操作失败")}},P=async a=>{var e,n,u;try{await V.delete(a),f.success("删除成功"),((e=s.value)==null?void 0:e.id)===a&&(s.value=null),k()}catch(p){f.error(((u=(n=p.response)==null?void 0:n.data)==null?void 0:u.message)||"删除失败")}},A=()=>{I.value=!0},H=async()=>{var a,e;try{const n=await V.generateMock();f.success(n.message),I.value=!1,k()}catch(n){f.error(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"生成失败")}},J=async()=>{var a,e;try{const n=await V.clearMock();f.success(n.message),I.value=!1,s.value=null,k()}catch(n){f.error(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"清空失败")}};return ue(()=>{k()}),(a,e)=>{const n=r("t-icon"),u=r("t-button"),p=r("t-space"),g=r("t-tag"),Q=r("t-tree"),W=r("t-loading"),X=r("t-popconfirm"),h=r("t-descriptions-item"),Y=r("t-descriptions"),E=r("t-link"),Z=r("t-table"),ee=r("t-card"),F=r("t-input"),C=r("t-form-item"),te=r("t-option"),le=r("t-select"),ae=r("t-textarea"),ne=r("t-input-number"),L=r("t-radio"),oe=r("t-radio-group"),se=r("t-form"),R=r("t-dialog");return c(),w("div",ve,[m("div",fe,[e[14]||(e[14]=m("h2",null,"部门管理",-1)),l(p,null,{default:t(()=>[l(u,{theme:"default",onClick:A},{icon:t(()=>[l(n,{name:"play-circle"})]),default:t(()=>[e[12]||(e[12]=d(" Mock数据 ",-1))]),_:1}),l(u,{theme:"primary",onClick:e[0]||(e[0]=o=>N())},{icon:t(()=>[l(n,{name:"add"})]),default:t(()=>[e[13]||(e[13]=d(" 新建部门 ",-1))]),_:1})]),_:1})]),l(ee,null,{default:t(()=>[m("div",_e,[m("div",be,[m("div",ge,[e[15]||(e[15]=m("h3",null,"组织架构",-1)),l(u,{size:"small",theme:"primary",variant:"text",onClick:k},{default:t(()=>[l(n,{name:"refresh"})]),_:1})]),l(W,{loading:z.value},{default:t(()=>[B.value.length>0?(c(),b(Q,{key:0,data:B.value,keys:{value:"id",label:"name",children:"children"},activable:!0,"active-multiple":!1,"expand-all":!0,hover:"",onActive:K},{label:t(({node:o})=>[m("span",ye,[l(n,{name:"usergroup",style:{"margin-right":"4px"}}),d(" "+v(o.data.name)+" ",1),o.data.memberCount>0?(c(),b(g,{key:0,theme:"primary",variant:"outline",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[d(v(o.data.memberCount)+"人 ",1)]),_:2},1024)):$("",!0)])]),_:1},8,["data"])):(c(),w("div",ke,[l(n,{name:"folder-open",size:"48px"}),e[17]||(e[17]=m("p",null,"暂无部门数据",-1)),l(u,{theme:"primary",size:"small",onClick:A},{default:t(()=>[...e[16]||(e[16]=[d("生成示例数据",-1)])]),_:1})]))]),_:1},8,["loading"])]),m("div",he,[s.value?(c(),w("div",Ce,[m("div",Ve,[m("h3",null,v(s.value.name),1),l(p,null,{default:t(()=>[l(u,{theme:"primary",size:"small",onClick:e[1]||(e[1]=o=>N(s.value))},{icon:t(()=>[l(n,{name:"add"})]),default:t(()=>[e[18]||(e[18]=d(" 添加子部门 ",-1))]),_:1}),l(u,{theme:"default",size:"small",onClick:e[2]||(e[2]=o=>S(s.value))},{icon:t(()=>[l(n,{name:"edit"})]),default:t(()=>[e[19]||(e[19]=d(" 编辑 ",-1))]),_:1}),l(X,{content:`确定删除部门 ${s.value.name}？`,onConfirm:e[3]||(e[3]=o=>P(s.value.id))},{default:t(()=>[l(u,{theme:"danger",size:"small",variant:"outline"},{icon:t(()=>[l(n,{name:"delete"})]),default:t(()=>[e[20]||(e[20]=d(" 删除 ",-1))]),_:1})]),_:1},8,["content"])]),_:1})]),m("div",we,[l(Y,{column:2,bordered:""},{default:t(()=>[l(h,{label:"部门编码"},{default:t(()=>[d(v(s.value.code),1)]),_:1}),l(h,{label:"状态"},{default:t(()=>[s.value.status==="active"?(c(),b(g,{key:0,theme:"success"},{default:t(()=>[...e[21]||(e[21]=[d("启用",-1)])]),_:1})):(c(),b(g,{key:1,theme:"default"},{default:t(()=>[...e[22]||(e[22]=[d("停用",-1)])]),_:1}))]),_:1}),l(h,{label:"成员数量"},{default:t(()=>[l(g,{theme:"primary",variant:"outline"},{default:t(()=>[d(v(s.value.memberCount)+"人",1)]),_:1})]),_:1}),l(h,{label:"排序号"},{default:t(()=>[d(v(s.value.sort),1)]),_:1}),l(h,{label:"创建时间",span:2},{default:t(()=>[d(v(new Date(s.value.createdAt).toLocaleString()),1)]),_:1}),l(h,{label:"描述",span:2},{default:t(()=>[d(v(s.value.description||"暂无描述"),1)]),_:1})]),_:1})]),s.value.children&&s.value.children.length>0?(c(),w("div",xe,[m("h4",null,"子部门 ("+v(s.value.children.length)+")",1),l(Z,{data:s.value.children,columns:q,"row-key":"id",size:"small",stripe:"",hover:""},{status:t(({row:o})=>[o.status==="active"?(c(),b(g,{key:0,theme:"success"},{default:t(()=>[...e[23]||(e[23]=[d("启用",-1)])]),_:1})):(c(),b(g,{key:1,theme:"default"},{default:t(()=>[...e[24]||(e[24]=[d("停用",-1)])]),_:1}))]),memberCount:t(({row:o})=>[l(g,{theme:"primary",variant:"outline"},{default:t(()=>[d(v(o.memberCount),1)]),_:2},1024)]),action:t(({row:o})=>[l(p,null,{default:t(()=>[l(E,{theme:"primary",hover:"color",onClick:de=>K([o.id])},{default:t(()=>[...e[25]||(e[25]=[d("查看",-1)])]),_:1},8,["onClick"]),l(E,{theme:"primary",hover:"color",onClick:de=>S(o)},{default:t(()=>[...e[26]||(e[26]=[d("编辑",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["data"])])):$("",!0)])):(c(),w("div",De,[l(n,{name:"info-circle",size:"48px"}),e[27]||(e[27]=m("p",null,"请从左侧选择一个部门查看详情",-1))]))])])]),_:1}),l(R,{visible:D.value,"onUpdate:visible":e[10]||(e[10]=o=>D.value=o),header:_.value?"编辑部门":M.value?`在 ${M.value.name} 下创建子部门`:"新建部门",width:"600px",onConfirm:O},{default:t(()=>[l(se,{ref:"formRef",data:i,rules:j,"label-width":"100px"},{default:t(()=>[l(C,{label:"部门名称",name:"name"},{default:t(()=>[l(F,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=o=>i.name=o),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),l(C,{label:"部门编码",name:"code"},{default:t(()=>[l(F,{modelValue:i.code,"onUpdate:modelValue":e[5]||(e[5]=o=>i.code=o),placeholder:"如：SALES",disabled:!!_.value},null,8,["modelValue","disabled"])]),_:1}),l(C,{label:"上级部门"},{default:t(()=>[l(le,{modelValue:i.parentId,"onUpdate:modelValue":e[6]||(e[6]=o=>i.parentId=o),placeholder:"请选择上级部门（留空为顶级部门）",clearable:"",disabled:!!M.value},{default:t(()=>[(c(!0),w(me,null,ce(G.value,o=>(c(),b(te,{key:o.id,value:o.id,label:o.name,disabled:_.value&&o.id===_.value.id},null,8,["value","label","disabled"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(C,{label:"描述"},{default:t(()=>[l(ae,{modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=o=>i.description=o),placeholder:"请输入描述",autosize:{minRows:2}},null,8,["modelValue"])]),_:1}),l(C,{label:"排序号"},{default:t(()=>[l(ne,{modelValue:i.sort,"onUpdate:modelValue":e[8]||(e[8]=o=>i.sort=o),min:0,placeholder:"数字越小越靠前"},null,8,["modelValue"])]),_:1}),_.value?(c(),b(C,{key:0,label:"状态"},{default:t(()=>[l(oe,{modelValue:i.status,"onUpdate:modelValue":e[9]||(e[9]=o=>i.status=o)},{default:t(()=>[l(L,{value:"active"},{default:t(()=>[...e[28]||(e[28]=[d("启用",-1)])]),_:1}),l(L,{value:"inactive"},{default:t(()=>[...e[29]||(e[29]=[d("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):$("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header"]),l(R,{visible:I.value,"onUpdate:visible":e[11]||(e[11]=o=>I.value=o),header:"生成Mock数据",width:"400px",onConfirm:H},{default:t(()=>[e[31]||(e[31]=m("p",null,"将生成示例部门数据（总公司及5个一级部门）",-1)),l(p,{direction:"vertical",style:{width:"100%","margin-top":"16px"}},{default:t(()=>[l(u,{theme:"danger",variant:"outline",block:"",onClick:J},{default:t(()=>[...e[30]||(e[30]=[d(" 清空所有部门数据 ",-1)])]),_:1})]),_:1})]),_:1},8,["visible"])])}}}),$e=pe(Ie,[["__scopeId","data-v-2ad73b02"]]);export{$e as default};
