import{d as j,j as P,u as T,r as b,k as G,l as O,M as x,b as d,c as S,e as s,h as a,w as o,i as w,t as u,o as y,F as q,f as H,p as J,x as Q,_ as U}from"./index-BQBF81MK.js";import{f as k}from"./form-HThWbM9f.js";import{i as W}from"./index-CGdFOYoS.js";const X={class:"page-container"},Y={class:"page-header"},Z={class:"page-title"},$={class:"stat-item"},tt={class:"stat-icon",style:{background:"#e3f2fd"}},st={class:"stat-content"},et={class:"stat-value"},at={class:"stat-item"},ot={class:"stat-icon",style:{background:"#e8f5e9"}},nt={class:"stat-content"},it={class:"stat-value"},lt={class:"stat-item"},rt={class:"stat-icon",style:{background:"#fff3e0"}},ct={class:"stat-content"},dt={class:"stat-value"},ut={class:"stat-item"},_t={class:"stat-icon",style:{background:"#fce4ec"}},mt={class:"stat-content"},ft={class:"stat-value"},pt=j({__name:"FormStats",setup(vt){const C=P(),g=T(),f=b(null),l=b(null),p=b(!1),v=C.params.id,z=[{colKey:"submittedAt",title:"提交时间",width:180,cell:(e,{row:t})=>B(t.submittedAt)},{colKey:"ip",title:"IP地址",width:150},{colKey:"data",title:"提交数据",cell:"data"}],A=G(()=>{var i;if(!((i=l.value)!=null&&i.dailySubmissions))return 0;const e=l.value.dailySubmissions.reduce((m,_)=>m+_.count,0),t=l.value.dailySubmissions.length||1;return(e/t).toFixed(1)}),B=e=>new Date(e).toLocaleString("zh-CN"),D=e=>Array.isArray(e)?e.join(", "):typeof e=="string"&&e.length>20?e.substring(0,20)+"...":e,F=e=>{if(!f.value)return e;const t=f.value.config.components.find(i=>i.id===e);return(t==null?void 0:t.label)||e},I=()=>{var e;!((e=l.value)!=null&&e.dailySubmissions)||l.value.dailySubmissions.length===0||Q(()=>{const t=document.getElementById("trend-chart");if(!t)return;const i=W(t),m=l.value.dailySubmissions.map(c=>c.date),_=l.value.dailySubmissions.map(c=>c.count),r={tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:m,boundaryGap:!1},yAxis:{type:"value"},series:[{name:"提交次数",type:"line",smooth:!0,data:_,areaStyle:{color:"rgba(0, 82, 217, 0.1)"},lineStyle:{color:"#0052d9"},itemStyle:{color:"#0052d9"}}]};i.setOption(r),window.addEventListener("resize",()=>{i.resize()})})},L=async()=>{p.value=!0;try{f.value=await k.getById(v),l.value=await k.getStatistics(v),I()}catch(e){x.error(e.message||"加载数据失败")}finally{p.value=!1}},N=()=>{g.push("/forms")};return O(()=>{if(!v){x.error("表单ID不存在"),g.push("/forms");return}L()}),(e,t)=>{const i=d("t-icon"),m=d("t-button"),_=d("t-space"),r=d("t-card"),c=d("t-col"),V=d("t-row"),E=d("t-tag"),K=d("t-table");return y(),S("div",X,[s("div",Y,[a(_,null,{default:o(()=>{var n;return[a(m,{variant:"text",onClick:N},{icon:o(()=>[a(i,{name:"chevron-left"})]),default:o(()=>[t[0]||(t[0]=w(" 返回 ",-1))]),_:1}),s("span",Z,"表单统计 - "+u((n=f.value)==null?void 0:n.title),1)]}),_:1})]),a(V,{gutter:16,style:{"margin-bottom":"24px"}},{default:o(()=>[a(c,{span:3},{default:o(()=>[a(r,{bordered:!1,class:"stat-card"},{default:o(()=>{var n;return[s("div",$,[s("div",tt,[a(i,{name:"browse",size:"24px",style:{color:"#1976d2"}})]),s("div",st,[t[1]||(t[1]=s("div",{class:"stat-label"},"浏览次数",-1)),s("div",et,u(((n=l.value)==null?void 0:n.viewCount)||0),1)])])]}),_:1})]),_:1}),a(c,{span:3},{default:o(()=>[a(r,{bordered:!1,class:"stat-card"},{default:o(()=>{var n;return[s("div",at,[s("div",ot,[a(i,{name:"check-circle",size:"24px",style:{color:"#388e3c"}})]),s("div",nt,[t[2]||(t[2]=s("div",{class:"stat-label"},"提交次数",-1)),s("div",it,u(((n=l.value)==null?void 0:n.submitCount)||0),1)])])]}),_:1})]),_:1}),a(c,{span:3},{default:o(()=>[a(r,{bordered:!1,class:"stat-card"},{default:o(()=>{var n;return[s("div",lt,[s("div",rt,[a(i,{name:"chart-pie",size:"24px",style:{color:"#f57c00"}})]),s("div",ct,[t[3]||(t[3]=s("div",{class:"stat-label"},"转化率",-1)),s("div",dt,u(((n=l.value)==null?void 0:n.conversionRate)||"0.0")+"%",1)])])]}),_:1})]),_:1}),a(c,{span:3},{default:o(()=>[a(r,{bordered:!1,class:"stat-card"},{default:o(()=>[s("div",ut,[s("div",_t,[a(i,{name:"usergroup",size:"24px",style:{color:"#c2185b"}})]),s("div",mt,[t[4]||(t[4]=s("div",{class:"stat-label"},"平均每日提交",-1)),s("div",ft,u(A.value),1)])])]),_:1})]),_:1})]),_:1}),a(r,{title:"提交趋势",bordered:!1,style:{"margin-bottom":"24px"}},{default:o(()=>[...t[5]||(t[5]=[s("div",{id:"trend-chart",style:{width:"100%",height:"300px"}},null,-1)])]),_:1}),a(r,{title:"最近提交记录",bordered:!1},{default:o(()=>{var n;return[a(K,{data:((n=l.value)==null?void 0:n.recentSubmissions)||[],columns:z,loading:p.value,"row-key":"id",stripe:"",hover:""},{data:o(({row:M})=>[a(_,{size:"small"},{default:o(()=>[(y(!0),S(q,null,H(M.data,(R,h)=>(y(),J(E,{key:h,theme:"default",variant:"outline"},{default:o(()=>[w(u(F(h))+": "+u(D(R)),1)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","loading"])]}),_:1})])}}}),ht=U(pt,[["__scopeId","data-v-6a5455c5"]]);export{ht as default};
