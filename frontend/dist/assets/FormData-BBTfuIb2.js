import{d as z,j as q,u as G,r as b,k as H,l as J,M as g,b as l,c as F,e as i,h as t,w as e,i as d,t as c,m as Q,o as w,F as W,f as X,p as Y,_ as Z}from"./index-BQBF81MK.js";import{f as L}from"./form-HThWbM9f.js";const ee={class:"page-container"},te={class:"page-header"},ae={class:"page-title"},oe={style:{display:"flex","align-items":"center",gap:"8px"}},ne={class:"stat-value"},se={style:{display:"flex","align-items":"center",gap:"8px"}},le={class:"stat-value"},ie={style:{display:"flex","align-items":"center",gap:"8px"}},re={class:"stat-value"},ue={key:0,class:"submission-detail"},de=z({__name:"FormData",setup(ce){const N=q(),j=G(),s=b(null),v=b([]),y=b(!1),x=b(!1),m=b(null),C=N.params.id,R=[{colKey:"submittedAt",title:"提交时间",width:180,cell:(o,{row:a})=>k(a.submittedAt)},{colKey:"ip",title:"IP地址",width:150},{colKey:"userAgent",title:"用户代理",ellipsis:!0},{colKey:"data",title:"操作",width:120,cell:"data",fixed:"right"}],E=H(()=>!s.value||s.value.viewCount===0?"0.0":(s.value.submitCount/s.value.viewCount*100).toFixed(1)),k=o=>new Date(o).toLocaleString("zh-CN"),B=o=>Array.isArray(o)?o.join(", "):o,I=o=>{if(!s.value)return o;const a=s.value.config.components.find(r=>r.id===o);return(a==null?void 0:a.label)||o},K=async()=>{y.value=!0;try{s.value=await L.getById(C),v.value=await L.getSubmissions(C)}catch(o){g.error(o.message||"加载数据失败")}finally{y.value=!1}},P=()=>{j.push("/forms")},S=o=>{m.value=o,x.value=!0},M=()=>{var f;if(v.value.length===0){g.warning("暂无数据可导出");return}const o=["提交时间","IP地址",...Object.keys(v.value[0].data).map(I)],a=v.value.map(u=>[k(u.submittedAt),u.ip||"",...Object.values(u.data).map(D=>B(D))]),r=[o,...a].map(u=>u.join(",")).join(`
`),_=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a");p.href=URL.createObjectURL(_),p.download=`${((f=s.value)==null?void 0:f.title)||"表单数据"}_${new Date().getTime()}.csv`,p.click(),g.success("导出成功")},O=()=>{g.warning("清空数据功能暂未实现")};return J(()=>{if(!C){g.error("表单ID不存在"),j.push("/forms");return}K()}),(o,a)=>{const r=l("t-icon"),_=l("t-button"),p=l("t-space"),f=l("t-card"),u=l("t-col"),D=l("t-row"),U=l("t-table"),h=l("t-descriptions-item"),V=l("t-descriptions"),$=l("t-divider"),T=l("t-dialog");return w(),F("div",ee,[i("div",te,[t(p,null,{default:e(()=>{var n;return[t(_,{variant:"text",onClick:P},{icon:e(()=>[t(r,{name:"chevron-left"})]),default:e(()=>[a[1]||(a[1]=d(" 返回 ",-1))]),_:1}),i("span",ae,"表单数据 - "+c((n=s.value)==null?void 0:n.title),1)]}),_:1}),t(p,null,{default:e(()=>[t(_,{theme:"default",onClick:M},{icon:e(()=>[t(r,{name:"download"})]),default:e(()=>[a[2]||(a[2]=d(" 导出数据 ",-1))]),_:1}),t(_,{theme:"danger",onClick:O},{icon:e(()=>[t(r,{name:"delete"})]),default:e(()=>[a[3]||(a[3]=d(" 清空数据 ",-1))]),_:1})]),_:1})]),t(D,{gutter:16,style:{"margin-bottom":"16px"}},{default:e(()=>[t(u,{span:4},{default:e(()=>[t(f,{title:"浏览次数",bordered:!1},{header:e(()=>[i("div",oe,[t(r,{name:"browse"}),a[4]||(a[4]=i("span",null,"浏览次数",-1))])]),default:e(()=>{var n;return[i("div",ne,c(((n=s.value)==null?void 0:n.viewCount)||0),1)]}),_:1})]),_:1}),t(u,{span:4},{default:e(()=>[t(f,{title:"提交次数",bordered:!1},{header:e(()=>[i("div",se,[t(r,{name:"check-circle"}),a[5]||(a[5]=i("span",null,"提交次数",-1))])]),default:e(()=>{var n;return[i("div",le,c(((n=s.value)==null?void 0:n.submitCount)||0),1)]}),_:1})]),_:1}),t(u,{span:4},{default:e(()=>[t(f,{title:"转化率",bordered:!1},{header:e(()=>[i("div",ie,[t(r,{name:"chart-pie"}),a[6]||(a[6]=i("span",null,"转化率",-1))])]),default:e(()=>[i("div",re,c(E.value)+"%",1)]),_:1})]),_:1})]),_:1}),t(U,{data:v.value,columns:R,loading:y.value,"row-key":"id",stripe:"",hover:"","max-height":"600"},{data:e(({row:n})=>[t(_,{theme:"primary",variant:"text",onClick:A=>S(n)},{default:e(()=>[...a[7]||(a[7]=[d(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["data","loading"]),t(T,{visible:x.value,"onUpdate:visible":a[0]||(a[0]=n=>x.value=n),header:"提交详情",width:"800px",footer:!1},{default:e(()=>[m.value?(w(),F("div",ue,[t(V,{column:1,bordered:""},{default:e(()=>[t(h,{label:"提交时间"},{default:e(()=>[d(c(k(m.value.submittedAt)),1)]),_:1}),t(h,{label:"IP地址"},{default:e(()=>[d(c(m.value.ip||"未知"),1)]),_:1}),t(h,{label:"用户代理"},{default:e(()=>[d(c(m.value.userAgent||"未知"),1)]),_:1})]),_:1}),t($,null,{default:e(()=>[...a[8]||(a[8]=[d("提交数据",-1)])]),_:1}),t(V,{column:1,bordered:""},{default:e(()=>[(w(!0),F(W,null,X(m.value.data,(n,A)=>(w(),Y(h,{key:A,label:I(A)},{default:e(()=>[d(c(B(n)),1)]),_:2},1032,["label"]))),128))]),_:1})])):Q("",!0)]),_:1},8,["visible"])])}}}),pe=Z(de,[["__scopeId","data-v-13fb58e5"]]);export{pe as default};
