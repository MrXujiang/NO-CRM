import{c as g}from"./contract-template-C-e1ZM1S.js";import{d as oe,r as i,l as ne,b as n,c as re,e as T,h as t,w as a,i as r,t as se,p as _,o as m,M as u,_ as ue}from"./index-BQBF81MK.js";const ie={class:"templates-page"},de={class:"page-header"},ce=["innerHTML"],me=oe({__name:"ContractTemplates",setup(pe){const $=i([]),x=i(!1),S=i(""),b=i(!1),U=i(!1),k=i(!1),y=i(null),q=i(""),z=i(10),p=i({current:1,pageSize:10,total:0}),s=i({name:"",code:"",category:"sales_contract",description:"",content:"",variables:[],clauseIds:[],requiredFields:[]}),B={name:[{required:!0,message:"请输入模板名称"}],code:[{required:!0,message:"请输入模板编码"}],category:[{required:!0,message:"请选择分类"}],content:[{required:!0,message:"请输入模板内容"}]},E=[{colKey:"name",title:"模板名称",width:180,ellipsis:!0},{colKey:"code",title:"编码",width:140},{colKey:"category",title:"分类",width:100},{colKey:"status",title:"状态",width:80},{colKey:"usageCount",title:"使用次数",width:90},{colKey:"createdAt",title:"创建时间",width:160,ellipsis:!0},{colKey:"action",title:"操作",width:220,fixed:"right"}],v=async()=>{x.value=!0;try{const o=await g.getAll(S.value,p.value.current,p.value.pageSize);$.value=o.data,p.value.total=o.total}catch{u.error("加载模板列表失败")}finally{x.value=!1}},H=()=>{v()},N=()=>{y.value=null,s.value={name:"",code:"",category:"sales_contract",description:"",content:"",variables:[],clauseIds:[],requiredFields:[]},b.value=!0},R=o=>{u.info("查看功能开发中...")},j=o=>{y.value=o,s.value={name:o.name,code:o.code,category:o.category,description:o.description||"",content:o.content,variables:o.variables||[],clauseIds:o.clauseIds||[],requiredFields:o.requiredFields||[]},b.value=!0},G=async o=>{try{await g.copy(o.id),u.success("复制成功"),v()}catch{u.error("复制失败")}},O=async o=>{try{const e=await g.preview(o.id,{"customer.name":"示例客户","order.totalAmount":"10000","contract.signDate":new Date().toLocaleDateString("zh-CN")});q.value=e.html,U.value=!0}catch{u.error("预览失败")}},J=async o=>{try{await g.delete(o),u.success("删除成功"),v()}catch{u.error("删除失败")}},Q=async()=>{try{y.value?(await g.update(y.value.id,s.value),u.success("更新成功")):(await g.create(s.value),u.success("创建成功")),b.value=!1,v()}catch{u.error(y.value?"更新失败":"创建失败")}},W=()=>{y.value=null},X=async()=>{try{const o=await g.generateMock(z.value);u.success(o.message),v()}catch{u.error("生成Mock数据失败")}},Y=async()=>{try{const o=await g.clearMock();u.success(o.message),k.value=!1,v()}catch{u.error("清空数据失败")}},Z=()=>{k.value=!1};return ne(()=>{v()}),(o,e)=>{const h=n("t-icon"),w=n("t-button"),V=n("t-space"),d=n("t-option"),K=n("t-select"),A=n("t-card"),c=n("t-tag"),C=n("t-link"),F=n("t-popconfirm"),ee=n("t-table"),te=n("t-pagination"),I=n("t-input"),f=n("t-form-item"),L=n("t-textarea"),ae=n("t-alert"),P=n("t-form"),D=n("t-dialog"),le=n("t-input-number");return m(),re("div",ie,[T("div",de,[e[15]||(e[15]=T("h2",null,"合同模板管理",-1)),t(V,null,{default:a(()=>[t(w,{theme:"default",onClick:e[0]||(e[0]=l=>k.value=!0)},{icon:a(()=>[t(h,{name:"data"})]),default:a(()=>[e[13]||(e[13]=r(" Mock数据 ",-1))]),_:1}),t(w,{theme:"primary",onClick:N},{icon:a(()=>[t(h,{name:"add"})]),default:a(()=>[e[14]||(e[14]=r(" 新建模板 ",-1))]),_:1})]),_:1})]),t(A,{class:"filter-card"},{default:a(()=>[t(V,null,{default:a(()=>[t(K,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=l=>S.value=l),placeholder:"全部分类",clearable:"",style:{width:"150px"},onChange:v},{default:a(()=>[t(d,{value:"sales_contract",label:"销售合同"}),t(d,{value:"service_agreement",label:"服务协议"}),t(d,{value:"nda",label:"保密协议"}),t(d,{value:"partnership",label:"合作协议"}),t(d,{value:"other",label:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(A,{style:{"margin-top":"16px"}},{default:a(()=>[t(ee,{data:$.value,columns:E,loading:x.value,"row-key":"id",stripe:"",hover:"","table-layout":"fixed"},{category:a(({row:l})=>[l.category==="sales_contract"?(m(),_(c,{key:0,theme:"success"},{default:a(()=>[...e[16]||(e[16]=[r("销售合同",-1)])]),_:1})):l.category==="service_agreement"?(m(),_(c,{key:1,theme:"primary"},{default:a(()=>[...e[17]||(e[17]=[r("服务协议",-1)])]),_:1})):l.category==="nda"?(m(),_(c,{key:2,theme:"warning"},{default:a(()=>[...e[18]||(e[18]=[r("保密协议",-1)])]),_:1})):l.category==="partnership"?(m(),_(c,{key:3,theme:"default"},{default:a(()=>[...e[19]||(e[19]=[r("合作协议",-1)])]),_:1})):(m(),_(c,{key:4},{default:a(()=>[...e[20]||(e[20]=[r("其他",-1)])]),_:1}))]),status:a(({row:l})=>[l.status==="active"?(m(),_(c,{key:0,theme:"success"},{default:a(()=>[...e[21]||(e[21]=[r("激活",-1)])]),_:1})):l.status==="draft"?(m(),_(c,{key:1,theme:"default"},{default:a(()=>[...e[22]||(e[22]=[r("草稿",-1)])]),_:1})):(m(),_(c,{key:2,theme:"danger"},{default:a(()=>[...e[23]||(e[23]=[r("已归档",-1)])]),_:1}))]),usageCount:a(({row:l})=>[t(c,{theme:"primary",variant:"outline"},{default:a(()=>[r(se(l.usageCount)+" 次",1)]),_:2},1024)]),action:a(({row:l})=>[t(V,null,{default:a(()=>[t(C,{theme:"primary",hover:"color",onClick:M=>R(l)},{default:a(()=>[...e[24]||(e[24]=[r("查看",-1)])]),_:1},8,["onClick"]),t(C,{theme:"primary",hover:"color",onClick:M=>j(l)},{default:a(()=>[...e[25]||(e[25]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(C,{theme:"primary",hover:"color",onClick:M=>G(l)},{default:a(()=>[...e[26]||(e[26]=[r("复制",-1)])]),_:1},8,["onClick"]),t(C,{theme:"primary",hover:"color",onClick:M=>O(l)},{default:a(()=>[...e[27]||(e[27]=[r("预览",-1)])]),_:1},8,["onClick"]),t(F,{content:"确定删除此模板吗？",onConfirm:M=>J(l.id)},{default:a(()=>[t(C,{theme:"danger",hover:"color"},{default:a(()=>[...e[28]||(e[28]=[r("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),t(te,{modelValue:p.value.current,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value.current=l),pageSize:p.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>p.value.pageSize=l),total:p.value.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",style:{"margin-top":"16px"},onChange:H},null,8,["modelValue","pageSize","total"])]),_:1}),t(D,{visible:b.value,"onUpdate:visible":e[9]||(e[9]=l=>b.value=l),header:y.value?"编辑模板":"新建模板",width:"900px",onConfirm:Q,onClose:W},{default:a(()=>[t(P,{data:s.value,rules:B,"label-align":"right","label-width":100},{default:a(()=>[t(f,{label:"模板名称",name:"name"},{default:a(()=>[t(I,{modelValue:s.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.name=l),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),t(f,{label:"模板编码",name:"code"},{default:a(()=>[t(I,{modelValue:s.value.code,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.code=l),placeholder:"如：TEMP-SALES-001"},null,8,["modelValue"])]),_:1}),t(f,{label:"分类",name:"category"},{default:a(()=>[t(K,{modelValue:s.value.category,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.category=l),placeholder:"请选择分类"},{default:a(()=>[t(d,{value:"sales_contract",label:"销售合同"}),t(d,{value:"service_agreement",label:"服务协议"}),t(d,{value:"nda",label:"保密协议"}),t(d,{value:"partnership",label:"合作协议"}),t(d,{value:"other",label:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"描述",name:"description"},{default:a(()=>[t(L,{modelValue:s.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.description=l),placeholder:"请输入模板描述",autosize:{minRows:2}},null,8,["modelValue"])]),_:1}),t(f,{label:"模板内容",name:"content"},{default:a(()=>[t(L,{modelValue:s.value.content,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.content=l),placeholder:"支持HTML格式，使用 ${变量名} 插入变量",autosize:{minRows:10}},null,8,["modelValue"])]),_:1}),t(f,{label:"提示"},{default:a(()=>[t(ae,{theme:"info",message:"变量示例：${customer.name}、${order.totalAmount}、${contract.signDate}"})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header"]),t(D,{visible:U.value,"onUpdate:visible":e[10]||(e[10]=l=>U.value=l),header:"模板预览",width:"900px",footer:!1},{default:a(()=>[T("div",{innerHTML:q.value,class:"preview-content"},null,8,ce)]),_:1},8,["visible"]),t(D,{visible:k.value,"onUpdate:visible":e[12]||(e[12]=l=>k.value=l),header:"Mock数据管理",width:"500px",onConfirm:Z},{default:a(()=>[t(P,{"label-align":"right","label-width":100},{default:a(()=>[t(f,{label:"生成数量"},{default:a(()=>[t(le,{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=l=>z.value=l),min:1,max:100,placeholder:"请输入生成数量"},null,8,["modelValue"])]),_:1}),t(f,{label:"操作"},{default:a(()=>[t(V,null,{default:a(()=>[t(w,{theme:"primary",onClick:X},{icon:a(()=>[t(h,{name:"add"})]),default:a(()=>[e[29]||(e[29]=r(" 生成Mock数据 ",-1))]),_:1}),t(F,{content:"确定清空所有模板数据吗？此操作不可恢复！",onConfirm:Y},{default:a(()=>[t(w,{theme:"danger"},{icon:a(()=>[t(h,{name:"delete"})]),default:a(()=>[e[30]||(e[30]=r(" 清空所有数据 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])])}}}),ge=ue(me,[["__scopeId","data-v-a9dd04ef"]]);export{ge as default};
