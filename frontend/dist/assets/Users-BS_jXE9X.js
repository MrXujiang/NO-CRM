import{C as b,d as ue,r as _,D as z,l as ie,b as s,c as D,e as N,h as a,w as l,i as m,o as u,F as O,f as j,p as f,m as T,M as v,_ as me}from"./index-BQBF81MK.js";import{r as pe}from"./role-DqAoZWTW.js";import{d as ce}from"./department-Cso6nBuK.js";const P={getAll(d,i,V,k){const p={};return d&&(p.page=d),i&&(p.pageSize=i),V&&(p.status=V),k&&(p.departmentId=k),b.get("/users",{params:p})},getOne(d){return b.get(`/users/${d}`)},create(d){return b.post("/users",d)},update(d,i){return b.patch(`/users/${d}`,i)},changePassword(d,i,V){return b.post(`/users/${d}/change-password`,{oldPassword:i,newPassword:V})},resetPassword(d,i){return b.post(`/users/${d}/reset-password`,{newPassword:i})},delete(d){return b.delete(`/users/${d}`)}},fe={class:"users-page"},ve={class:"page-header"},ge={class:"filter-bar"},we=ue({__name:"Users",setup(d){const i=_(!1),V=_([]),k=_([]),p=_([]),C=_(!1),x=_(!1),g=_(null),K=_(null),y=z({status:void 0,departmentId:void 0}),w=z({current:1,pageSize:10,total:0}),n=z({email:"",password:"",name:"",phone:"",roleId:"",departmentId:"",isAdmin:!1,status:"active"}),h=z({newPassword:""}),G={email:[{required:!0,message:"请输入邮箱"}],password:[{required:!0,message:"请输入密码"}],name:[{required:!0,message:"请输入姓名"}]},H=[{colKey:"name",title:"姓名",width:120},{colKey:"email",title:"邮箱",width:200},{colKey:"phone",title:"手机号",width:130},{colKey:"isAdmin",title:"用户类型",width:100,cell:"isAdmin"},{colKey:"status",title:"状态",width:80,cell:"status"},{colKey:"action",title:"操作",width:220,cell:"action",fixed:"right"}],I=async()=>{var o,e;i.value=!0;try{const r=await P.getAll(w.current,w.pageSize,y.status,y.departmentId);V.value=r.data,w.total=r.total}catch(r){v.error(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"加载用户列表失败")}finally{i.value=!1}},J=async()=>{try{const o=await pe.getAll(1,100,"active");k.value=o.data}catch(o){console.error("加载角色列表失败",o)}},Q=async()=>{try{const o=await ce.getAll(1,100,"active");p.value=o.data}catch(o){console.error("加载部门列表失败",o)}},W=()=>{I()},X=()=>{g.value=null,Object.assign(n,{email:"",password:"",name:"",phone:"",roleId:"",departmentId:"",isAdmin:!1,status:"active"}),C.value=!0},Y=o=>{g.value=o,Object.assign(n,{email:o.email,password:"",name:o.name,phone:o.phone||"",roleId:o.roleId||"",departmentId:o.departmentId||"",isAdmin:o.isAdmin,status:o.status}),C.value=!0},Z=async()=>{var o,e;try{g.value?(await P.update(g.value.id,{name:n.name,phone:n.phone,roleId:n.roleId||void 0,departmentId:n.departmentId||void 0,isAdmin:n.isAdmin,status:n.status}),v.success("更新成功")):(await P.create(n),v.success("创建成功")),C.value=!1,I()}catch(r){v.error(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"操作失败")}},ee=o=>{K.value=o,h.newPassword="",x.value=!0},te=async()=>{var o,e;if(!K.value||!h.newPassword){v.warning("请输入新密码");return}try{await P.resetPassword(K.value.id,h.newPassword),v.success("密码重置成功"),x.value=!1}catch(r){v.error(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"密码重置失败")}},ae=async o=>{var e,r;try{await P.delete(o),v.success("删除成功"),I()}catch(R){v.error(((r=(e=R.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败")}};return ie(()=>{I(),J(),Q()}),(o,e)=>{const r=s("t-icon"),R=s("t-button"),U=s("t-option"),S=s("t-select"),q=s("t-space"),$=s("t-tag"),B=s("t-link"),le=s("t-popconfirm"),oe=s("t-table"),ne=s("t-pagination"),se=s("t-card"),A=s("t-input"),c=s("t-form-item"),de=s("t-switch"),F=s("t-radio"),re=s("t-radio-group"),M=s("t-form"),E=s("t-dialog");return u(),D("div",fe,[N("div",ve,[e[16]||(e[16]=N("h2",null,"用户管理",-1)),a(R,{theme:"primary",onClick:X},{icon:l(()=>[a(r,{name:"user-add"})]),default:l(()=>[e[15]||(e[15]=m(" 新建用户 ",-1))]),_:1})]),a(se,null,{default:l(()=>[N("div",ge,[a(q,null,{default:l(()=>[a(S,{modelValue:y.status,"onUpdate:modelValue":e[0]||(e[0]=t=>y.status=t),placeholder:"状态筛选",clearable:"",style:{width:"150px"},onChange:I},{default:l(()=>[a(U,{value:"active",label:"启用"}),a(U,{value:"inactive",label:"停用"})]),_:1},8,["modelValue"]),a(S,{modelValue:y.departmentId,"onUpdate:modelValue":e[1]||(e[1]=t=>y.departmentId=t),placeholder:"部门筛选",clearable:"",style:{width:"200px"},onChange:I},{default:l(()=>[(u(!0),D(O,null,j(p.value,t=>(u(),f(U,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),a(oe,{data:V.value,columns:H,loading:i.value,"row-key":"id",stripe:"",hover:""},{isAdmin:l(({row:t})=>[t.isAdmin?(u(),f($,{key:0,theme:"warning"},{default:l(()=>[...e[17]||(e[17]=[m("管理员",-1)])]),_:1})):(u(),f($,{key:1,theme:"default"},{default:l(()=>[...e[18]||(e[18]=[m("普通用户",-1)])]),_:1}))]),status:l(({row:t})=>[t.status==="active"?(u(),f($,{key:0,theme:"success"},{default:l(()=>[...e[19]||(e[19]=[m("启用",-1)])]),_:1})):(u(),f($,{key:1,theme:"default"},{default:l(()=>[...e[20]||(e[20]=[m("停用",-1)])]),_:1}))]),action:l(({row:t})=>[a(q,null,{default:l(()=>[a(B,{theme:"primary",hover:"color",onClick:L=>Y(t)},{default:l(()=>[...e[21]||(e[21]=[m("编辑",-1)])]),_:1},8,["onClick"]),a(B,{theme:"warning",hover:"color",onClick:L=>ee(t)},{default:l(()=>[...e[22]||(e[22]=[m("重置密码",-1)])]),_:1},8,["onClick"]),a(le,{content:`确定删除用户 ${t.name}？`,onConfirm:L=>ae(t.id)},{default:l(()=>[a(B,{theme:"danger",hover:"color"},{default:l(()=>[...e[23]||(e[23]=[m("删除",-1)])]),_:1})]),_:1},8,["content","onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),a(ne,{modelValue:w.current,"onUpdate:modelValue":e[2]||(e[2]=t=>w.current=t),pageSize:w.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>w.pageSize=t),total:w.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",style:{"margin-top":"16px"},onChange:W},null,8,["modelValue","pageSize","total"])]),_:1}),a(E,{visible:C.value,"onUpdate:visible":e[12]||(e[12]=t=>C.value=t),header:g.value?"编辑用户":"新建用户",width:"600px",onConfirm:Z},{default:l(()=>[a(M,{ref:"formRef",data:n,rules:G,"label-width":"100px"},{default:l(()=>[a(c,{label:"邮箱",name:"email"},{default:l(()=>[a(A,{modelValue:n.email,"onUpdate:modelValue":e[4]||(e[4]=t=>n.email=t),placeholder:"请输入邮箱",disabled:!!g.value},null,8,["modelValue","disabled"])]),_:1}),g.value?T("",!0):(u(),f(c,{key:0,label:"密码",name:"password"},{default:l(()=>[a(A,{modelValue:n.password,"onUpdate:modelValue":e[5]||(e[5]=t=>n.password=t),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),a(c,{label:"姓名",name:"name"},{default:l(()=>[a(A,{modelValue:n.name,"onUpdate:modelValue":e[6]||(e[6]=t=>n.name=t),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),a(c,{label:"手机号"},{default:l(()=>[a(A,{modelValue:n.phone,"onUpdate:modelValue":e[7]||(e[7]=t=>n.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(c,{label:"角色"},{default:l(()=>[a(S,{modelValue:n.roleId,"onUpdate:modelValue":e[8]||(e[8]=t=>n.roleId=t),placeholder:"请选择角色",clearable:""},{default:l(()=>[(u(!0),D(O,null,j(k.value,t=>(u(),f(U,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"部门"},{default:l(()=>[a(S,{modelValue:n.departmentId,"onUpdate:modelValue":e[9]||(e[9]=t=>n.departmentId=t),placeholder:"请选择部门",clearable:""},{default:l(()=>[(u(!0),D(O,null,j(p.value,t=>(u(),f(U,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"管理员权限"},{default:l(()=>[a(de,{modelValue:n.isAdmin,"onUpdate:modelValue":e[10]||(e[10]=t=>n.isAdmin=t)},null,8,["modelValue"])]),_:1}),g.value?(u(),f(c,{key:1,label:"状态"},{default:l(()=>[a(re,{modelValue:n.status,"onUpdate:modelValue":e[11]||(e[11]=t=>n.status=t)},{default:l(()=>[a(F,{value:"active"},{default:l(()=>[...e[24]||(e[24]=[m("启用",-1)])]),_:1}),a(F,{value:"inactive"},{default:l(()=>[...e[25]||(e[25]=[m("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):T("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header"]),a(E,{visible:x.value,"onUpdate:visible":e[14]||(e[14]=t=>x.value=t),header:"重置密码",width:"400px",onConfirm:te},{default:l(()=>[a(M,{data:h,"label-width":"100px"},{default:l(()=>[a(c,{label:"新密码"},{default:l(()=>[a(A,{modelValue:h.newPassword,"onUpdate:modelValue":e[13]||(e[13]=t=>h.newPassword=t),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}}),ye=me(we,[["__scopeId","data-v-871730fa"]]);export{ye as default};
