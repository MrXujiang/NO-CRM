import{r as w}from"./role-DqAoZWTW.js";import{p as de}from"./permission-D5fcBuTN.js";import{d as ue,r as h,D as M,l as me,b as l,c as g,e as P,h as s,w as o,i as c,p as v,m as x,o as d,t as S,F as j,f as E,M as y,_ as ce}from"./index-BQBF81MK.js";const pe={class:"roles-page"},fe={class:"page-header"},_e={key:0,style:{color:"#ed7b2f","font-size":"12px","margin-top":"4px"}},ge={key:0,style:{color:"#0052d9","font-size":"12px","margin-top":"4px"}},ve={key:0,style:{color:"#ed7b2f","font-size":"12px","margin-top":"4px"}},ye={key:0,style:{"max-height":"400px","overflow-y":"auto",border:"1px solid #dcdcdc","border-radius":"3px",padding:"16px"}},be={style:{display:"flex","align-items":"center","margin-bottom":"8px"}},he=ue({__name:"Roles",setup(xe){const I=h(!1),z=h(!1),R=h([]),r=h(null),k=h(!1),p=h(null),_=M({current:1,pageSize:10,total:0}),n=M({name:"",code:"",description:"",permissionIds:[],status:"active"}),F={name:[{required:!0,message:"请输入角色名称"}],code:[{required:!0,message:"请输入角色编码"}]},O=[{colKey:"name",title:"角色名称",width:150},{colKey:"code",title:"编码",width:150},{colKey:"description",title:"描述",ellipsis:!0},{colKey:"isSystem",title:"类型",width:100,cell:"isSystem"},{colKey:"userCount",title:"用户数",width:100,cell:"userCount"},{colKey:"status",title:"状态",width:100,cell:"status"},{colKey:"action",title:"操作",width:150,cell:"action",fixed:"right"}],$={customer:"客户",lead:"线索",activity:"跟进记录",task:"任务",product:"产品",product_category:"产品分类",order:"订单",contract:"合同",contract_template:"合同模板",user:"用户",role:"角色",department:"部门",permission:"权限",statistics:"统计报表",system:"系统设置"},q=t=>$[t]||t,U=t=>!r.value||!r.value[t]?0:r.value[t].filter(i=>n.permissionIds.includes(i.id)).length,G=t=>{if(!r.value||!r.value[t])return!1;const e=r.value[t];return e.length>0&&e.every(i=>n.permissionIds.includes(i.id))},L=t=>{if(!r.value||!r.value[t])return!1;const e=U(t),i=r.value[t].length;return e>0&&e<i},T=(t,e)=>{if(!r.value||!r.value[t])return;const b=r.value[t].map(m=>m.id);e?b.forEach(m=>{n.permissionIds.includes(m)||n.permissionIds.push(m)}):n.permissionIds=n.permissionIds.filter(m=>!b.includes(m))},V=async()=>{var t,e;I.value=!0;try{const i=await w.getAll(_.current,_.pageSize);R.value=i.data,_.total=i.total}catch(i){y.error(((e=(t=i.response)==null?void 0:t.data)==null?void 0:e.message)||"加载角色列表失败")}finally{I.value=!1}},K=async()=>{if(!r.value){z.value=!0;try{r.value=await de.getGrouped()}catch{y.error("加载权限列表失败")}finally{z.value=!1}}},H=()=>{V()},J=async()=>{await K(),p.value=null,Object.assign(n,{name:"",code:"",description:"",permissionIds:[],status:"active"}),k.value=!0},Q=async t=>{await K(),p.value=t,Object.assign(n,{name:t.name,code:t.code,description:t.description||"",permissionIds:[...t.permissionIds],status:t.status}),k.value=!0},W=async()=>{var t,e;try{p.value?(await w.update(p.value.id,{name:n.name,description:n.description,permissionIds:n.permissionIds,status:n.status}),y.success("更新成功")):(await w.create(n),y.success("创建成功")),k.value=!1,V()}catch(i){y.error(((e=(t=i.response)==null?void 0:t.data)==null?void 0:e.message)||"操作失败")}},X=async t=>{var e,i;try{await w.delete(t),y.success("删除成功"),V()}catch(b){y.error(((i=(e=b.response)==null?void 0:e.data)==null?void 0:i.message)||"删除失败")}};return me(()=>{V()}),(t,e)=>{const i=l("t-icon"),b=l("t-button"),m=l("t-tag"),N=l("t-link"),Y=l("t-popconfirm"),Z=l("t-space"),ee=l("t-table"),te=l("t-pagination"),oe=l("t-card"),A=l("t-input"),C=l("t-form-item"),ae=l("t-textarea"),D=l("t-checkbox"),se=l("t-checkbox-group"),ne=l("t-loading"),B=l("t-radio"),le=l("t-radio-group"),ie=l("t-form"),re=l("t-dialog");return d(),g("div",pe,[P("div",fe,[e[9]||(e[9]=P("h2",null,"角色管理",-1)),s(b,{theme:"primary",onClick:J},{icon:o(()=>[s(i,{name:"add"})]),default:o(()=>[e[8]||(e[8]=c(" 新建角色 ",-1))]),_:1})]),s(oe,null,{default:o(()=>[s(ee,{data:R.value,columns:O,loading:I.value,"row-key":"id",stripe:"",hover:""},{isSystem:o(({row:a})=>[a.isSystem?(d(),v(m,{key:0,theme:"warning"},{default:o(()=>[...e[10]||(e[10]=[c("系统角色",-1)])]),_:1})):(d(),v(m,{key:1,theme:"default"},{default:o(()=>[...e[11]||(e[11]=[c("自定义",-1)])]),_:1}))]),status:o(({row:a})=>[a.status==="active"?(d(),v(m,{key:0,theme:"success"},{default:o(()=>[...e[12]||(e[12]=[c("启用",-1)])]),_:1})):(d(),v(m,{key:1,theme:"default"},{default:o(()=>[...e[13]||(e[13]=[c("停用",-1)])]),_:1}))]),userCount:o(({row:a})=>[s(m,{theme:"primary",variant:"outline"},{default:o(()=>[c(S(a.userCount),1)]),_:2},1024)]),action:o(({row:a})=>[s(Z,null,{default:o(()=>[s(N,{theme:"primary",hover:"color",onClick:u=>Q(a)},{default:o(()=>[...e[14]||(e[14]=[c("编辑",-1)])]),_:1},8,["onClick"]),a.isSystem?x("",!0):(d(),v(Y,{key:0,content:`确定删除角色 ${a.name}？`,onConfirm:u=>X(a.id)},{default:o(()=>[s(N,{theme:"danger",hover:"color"},{default:o(()=>[...e[15]||(e[15]=[c("删除",-1)])]),_:1})]),_:1},8,["content","onConfirm"]))]),_:2},1024)]),_:1},8,["data","loading"]),s(te,{modelValue:_.current,"onUpdate:modelValue":e[0]||(e[0]=a=>_.current=a),pageSize:_.pageSize,"onUpdate:pageSize":e[1]||(e[1]=a=>_.pageSize=a),total:_.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",style:{"margin-top":"16px"},onChange:H},null,8,["modelValue","pageSize","total"])]),_:1}),s(re,{visible:k.value,"onUpdate:visible":e[7]||(e[7]=a=>k.value=a),header:p.value?"编辑角色":"新建角色",width:"700px",onConfirm:W},{default:o(()=>[s(ie,{ref:"formRef",data:n,rules:F,"label-width":"100px"},{default:o(()=>[s(C,{label:"角色名称",name:"name"},{default:o(()=>{var a,u;return[s(A,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=f=>n.name=f),placeholder:"请输入角色名称",disabled:(a=p.value)==null?void 0:a.isSystem},null,8,["modelValue","disabled"]),(u=p.value)!=null&&u.isSystem?(d(),g("div",_e," 系统角色的名称不可修改 ")):x("",!0)]}),_:1}),s(C,{label:"角色编码",name:"code"},{default:o(()=>[s(A,{modelValue:n.code,"onUpdate:modelValue":e[3]||(e[3]=a=>n.code=a),placeholder:"如：sales_manager",disabled:!!p.value},null,8,["modelValue","disabled"]),p.value?(d(),g("div",ge," 角色编码创建后不可修改 ")):x("",!0)]),_:1}),s(C,{label:"描述"},{default:o(()=>{var a,u;return[s(ae,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=f=>n.description=f),placeholder:"请输入描述",autosize:{minRows:2},disabled:(a=p.value)==null?void 0:a.isSystem},null,8,["modelValue","disabled"]),(u=p.value)!=null&&u.isSystem?(d(),g("div",ve," 系统角色的描述不可修改 ")):x("",!0)]}),_:1}),s(C,{label:"权限配置"},{default:o(()=>[s(ne,{loading:z.value},{default:o(()=>[r.value?(d(),g("div",ye,[(d(!0),g(j,null,E(r.value,(a,u)=>(d(),g("div",{key:u,style:{"margin-bottom":"16px","padding-bottom":"12px","border-bottom":"1px solid #f0f0f0"}},[P("div",be,[s(D,{checked:G(u),indeterminate:L(u),onChange:f=>T(u,f),style:{"font-weight":"500","margin-right":"8px"}},{default:o(()=>[c(S(q(u)),1)]),_:2},1032,["checked","indeterminate","onChange"]),s(m,{theme:"primary",variant:"outline",size:"small"},{default:o(()=>[c(S(U(u))+"/"+S(a.length),1)]),_:2},1024)]),s(se,{modelValue:n.permissionIds,"onUpdate:modelValue":e[5]||(e[5]=f=>n.permissionIds=f),style:{"margin-left":"24px"}},{default:o(()=>[(d(!0),g(j,null,E(a,f=>(d(),v(D,{key:f.id,value:f.id,style:{"margin-right":"16px","margin-bottom":"8px"}},{default:o(()=>[c(S(f.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])]))),128))])):x("",!0)]),_:1},8,["loading"])]),_:1}),p.value?(d(),v(C,{key:0,label:"状态"},{default:o(()=>[s(le,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=a=>n.status=a)},{default:o(()=>[s(B,{value:"active"},{default:o(()=>[...e[16]||(e[16]=[c("启用",-1)])]),_:1}),s(B,{value:"inactive"},{default:o(()=>[...e[17]||(e[17]=[c("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):x("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header"])])}}}),Ve=ce(he,[["__scopeId","data-v-d4cb0b50"]]);export{Ve as default};
