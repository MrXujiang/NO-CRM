import{d as N,r as U,z as ee,b as s,c as M,h as l,m as R,w as t,F as ae,f as le,e as w,t as I,n as T,o as c,_ as E,D as F,l as te,i as u,p as $,E as oe,G as ne,M as f}from"./index-BQBF81MK.js";import{p as S}from"./product-category-BH--ZeEQ.js";const se={class:"icon-picker"},re={style:{padding:"8px 12px",color:"#666","font-size":"12px","border-bottom":"1px solid #e7e7e7"}},de={class:"icon-option"},ie={key:0,class:"icon-preview"},me=N({__name:"IconPicker",props:{modelValue:{},placeholder:{default:"选择图标"},previewColor:{default:"#0052d9"}},emits:["update:modelValue"],setup(D,{emit:C}){const k=D,_=C,d=U(k.modelValue||"");ee(()=>k.modelValue,h=>{d.value=h||""});const i=h=>{_("update:modelValue",h)},o=[{name:"desktop",label:"桌面/电脑"},{name:"shop",label:"商店"},{name:"chart-bar",label:"柱状图"},{name:"chart-pie",label:"饼图"},{name:"chart-line",label:"折线图"},{name:"chart-bubble",label:"气泡图"},{name:"dashboard",label:"仪表盘"},{name:"user",label:"用户"},{name:"user-talk",label:"用户对话"},{name:"usergroup",label:"用户组"},{name:"code",label:"代码"},{name:"laptop",label:"笔记本"},{name:"service",label:"客服"},{name:"tools",label:"工具"},{name:"setting",label:"设置"},{name:"folder",label:"文件夹"},{name:"folder-open",label:"打开文件夹"},{name:"file",label:"文件"},{name:"file-paste",label:"文件粘贴"},{name:"file-copy",label:"文件复制"},{name:"book",label:"书籍"},{name:"layers",label:"图层"},{name:"mail",label:"邮件"},{name:"chat",label:"聊天"},{name:"notification",label:"通知"},{name:"phone",label:"电话"},{name:"image",label:"图片"},{name:"video",label:"视频"},{name:"sound",label:"声音"},{name:"camera",label:"相机"},{name:"edit",label:"编辑"},{name:"delete",label:"删除"},{name:"add",label:"添加"},{name:"close",label:"关闭"},{name:"check",label:"勾选"},{name:"arrow-up",label:"向上箭头"},{name:"arrow-down",label:"向下箭头"},{name:"arrow-left",label:"向左箭头"},{name:"arrow-right",label:"向右箭头"},{name:"star",label:"星星"},{name:"heart",label:"心形"},{name:"flag",label:"旗帜"},{name:"location",label:"位置"},{name:"table",label:"首页"},{name:"calendar",label:"日历"},{name:"time",label:"时间"},{name:"lock-on",label:"锁定"},{name:"lock-off",label:"解锁"},{name:"search",label:"搜索"},{name:"filter",label:"筛选"},{name:"cloud",label:"云"},{name:"cloud-download",label:"云下载"},{name:"cloud-upload",label:"云上传"},{name:"link",label:"链接"},{name:"attach",label:"附件"},{name:"wifi",label:"WiFi"},{name:"bluetooth",label:"蓝牙"},{name:"print",label:"打印"},{name:"download",label:"下载"},{name:"upload",label:"上传"},{name:"share",label:"分享"},{name:"refresh",label:"刷新"},{name:"loading",label:"加载中"},{name:"poweroff",label:"关机"},{name:"money-circle",label:"金钱"},{name:"gift",label:"礼物"},{name:"cart",label:"购物车"},{name:"creditcard",label:"信用卡"},{name:"wallet",label:"钱包"},{name:"order-adjustment-column",label:"订单调整"},{name:"bulletpoint",label:"列表"},{name:"view-list",label:"视图列表"},{name:"view-module",label:"视图模块"},{name:"browse",label:"浏览"},{name:"precise-monitor",label:"精准监控"},{name:"server",label:"服务器"},{name:"data",label:"数据"}];return(h,K)=>{const p=s("t-icon"),A=s("t-option"),P=s("t-select");return c(),M("div",se,[l(P,{modelValue:d.value,"onUpdate:modelValue":K[0]||(K[0]=m=>d.value=m),placeholder:D.placeholder,filterable:"",clearable:"",onChange:i},{panelTopContent:t(()=>[w("div",re," 常用图标（"+I(o.length)+"个） ",1)]),default:t(()=>[(c(),M(ae,null,le(o,m=>l(A,{key:m.name,value:m.name,label:m.label},{default:t(()=>[w("div",de,[l(p,{name:m.name,style:{"font-size":"18px","margin-right":"8px"}},null,8,["name"]),w("span",null,I(m.label),1)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue","placeholder"]),d.value?(c(),M("div",ie,[l(p,{name:d.value,style:T({fontSize:"24px",color:D.previewColor})},null,8,["name","style"])])):R("",!0)])}}}),ue=E(me,[["__scopeId","data-v-3c9bae0f"]]),ce={class:"product-categories-page"},pe={class:"page-header"},be={key:1},fe=N({__name:"ProductCategories",setup(D){const C=U(!1),k=U([]),_=U(!1),d=U(null),i=F({current:1,pageSize:10,total:0}),o=F({name:"",code:"",description:"",icon:"",color:"#0052d9",sort:0,status:"active"}),h={name:[{required:!0,message:"请输入分类名称"}],code:[{required:!0,message:"请输入分类编码"}]},K=[{colKey:"icon",title:"图标",width:80,cell:"icon"},{colKey:"name",title:"分类名称",width:150},{colKey:"code",title:"编码",width:120},{colKey:"description",title:"描述",ellipsis:!0},{colKey:"sort",title:"排序",width:80},{colKey:"productCount",title:"产品数",width:100,cell:"productCount"},{colKey:"status",title:"状态",width:100,cell:"status"},{colKey:"action",title:"操作",width:150,cell:"action",fixed:"right"}],p=async()=>{var n,e;C.value=!0;try{const r=await S.getAll(i.current,i.pageSize);k.value=r.data,i.total=r.total}catch(r){f.error(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.message)||"加载分类列表失败")}finally{C.value=!1}},A=()=>{p()},P=()=>{d.value=null,Object.assign(o,{name:"",code:"",description:"",icon:"",color:"#0052d9",sort:0,status:"active"}),_.value=!0},m=n=>{d.value=n,Object.assign(o,{name:n.name,code:n.code,description:n.description||"",icon:n.icon||"",color:n.color||"#0052d9",sort:n.sort,status:n.status}),_.value=!0},O=async()=>{var n,e,r,g,x,y,z;try{if(d.value)await S.update(d.value.id,o),f.success("更新成功");else{const{status:b,...V}=o;console.log("创建分类数据:",V),await S.create(V),f.success("创建成功")}_.value=!1,p()}catch(b){console.error("保存失败:",b),console.error("错误响应:",(n=b.response)==null?void 0:n.data);const V=((r=(e=b.response)==null?void 0:e.data)==null?void 0:r.message)||(Array.isArray((x=(g=b.response)==null?void 0:g.data)==null?void 0:x.message)?(z=(y=b.response)==null?void 0:y.data)==null?void 0:z.message.join(", "):"")||"操作失败";f.error(V)}},q=async n=>{var e,r;try{await S.delete(n),f.success("删除成功"),p()}catch(g){f.error(((r=(e=g.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败")}},G=async()=>{var n,e;try{const r=await S.generateMock();f.success(r.message),p()}catch(r){f.error(((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.message)||"生成失败")}};return te(()=>{p()}),(n,e)=>{const r=s("t-icon"),g=s("t-button"),x=s("t-space"),y=s("t-tag"),z=s("t-link"),b=s("t-popconfirm"),V=s("t-table"),L=s("t-pagination"),W=s("t-card"),j=s("t-input"),v=s("t-form-item"),H=s("t-textarea"),J=s("t-input-number"),B=s("t-radio"),Q=s("t-radio-group"),X=s("t-form"),Y=s("t-dialog");return c(),M("div",ce,[w("div",pe,[e[13]||(e[13]=w("h2",null,"产品分类管理",-1)),l(x,null,{default:t(()=>[l(g,{theme:"default",onClick:G},{icon:t(()=>[l(r,{name:"data"})]),default:t(()=>[e[11]||(e[11]=u(" 生成Mock数据 ",-1))]),_:1}),l(g,{theme:"primary",onClick:P},{icon:t(()=>[l(r,{name:"add"})]),default:t(()=>[e[12]||(e[12]=u(" 新建分类 ",-1))]),_:1})]),_:1})]),l(W,null,{default:t(()=>[l(V,{data:k.value,columns:K,loading:C.value,"row-key":"id",stripe:"",hover:""},{icon:t(({row:a})=>[a.icon?(c(),$(r,{key:0,name:a.icon,style:T({color:a.color||"#0052d9",fontSize:"20px"})},null,8,["name","style"])):(c(),M("span",be,"-"))]),status:t(({row:a})=>[a.status==="active"?(c(),$(y,{key:0,theme:"success"},{default:t(()=>[...e[14]||(e[14]=[u("启用",-1)])]),_:1})):(c(),$(y,{key:1,theme:"default"},{default:t(()=>[...e[15]||(e[15]=[u("停用",-1)])]),_:1}))]),productCount:t(({row:a})=>[l(y,{theme:"primary",variant:"outline"},{default:t(()=>[u(I(a.productCount),1)]),_:2},1024)]),action:t(({row:a})=>[l(x,null,{default:t(()=>[l(z,{theme:"primary",hover:"color",onClick:Z=>m(a)},{default:t(()=>[...e[16]||(e[16]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(b,{content:a.productCount>0?`该分类下有 ${a.productCount} 个产品，确定删除吗？`:"确定删除此分类吗？",onConfirm:Z=>q(a.id)},{default:t(()=>[l(z,{theme:"danger",hover:"color"},{default:t(()=>[...e[17]||(e[17]=[u("删除",-1)])]),_:1})]),_:1},8,["content","onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),l(L,{modelValue:i.current,"onUpdate:modelValue":e[0]||(e[0]=a=>i.current=a),pageSize:i.pageSize,"onUpdate:pageSize":e[1]||(e[1]=a=>i.pageSize=a),total:i.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",style:{"margin-top":"16px"},onChange:A},null,8,["modelValue","pageSize","total"])]),_:1}),l(Y,{visible:_.value,"onUpdate:visible":e[10]||(e[10]=a=>_.value=a),header:d.value?"编辑分类":"新建分类",width:"600px",onConfirm:O},{default:t(()=>[l(X,{ref:"formRef",data:o,rules:h,"label-width":"100px"},{default:t(()=>[l(v,{label:"分类名称",name:"name"},{default:t(()=>[l(j,{modelValue:o.name,"onUpdate:modelValue":e[2]||(e[2]=a=>o.name=a),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"分类编码",name:"code"},{default:t(()=>[l(j,{modelValue:o.code,"onUpdate:modelValue":e[3]||(e[3]=a=>o.code=a),placeholder:"如：CRM、DATA"},null,8,["modelValue"])]),_:1}),l(v,{label:"描述"},{default:t(()=>[l(H,{modelValue:o.description,"onUpdate:modelValue":e[4]||(e[4]=a=>o.description=a),placeholder:"请输入描述",autosize:{minRows:2}},null,8,["modelValue"])]),_:1}),l(v,{label:"图标"},{default:t(()=>[l(ue,{modelValue:o.icon,"onUpdate:modelValue":e[5]||(e[5]=a=>o.icon=a),"preview-color":o.color},null,8,["modelValue","preview-color"])]),_:1}),l(v,{label:"颜色"},{default:t(()=>[l(j,{modelValue:o.color,"onUpdate:modelValue":e[7]||(e[7]=a=>o.color=a),placeholder:"如：#0052d9"},{suffix:t(()=>[oe(w("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=a=>o.color=a),style:{width:"30px",height:"30px",border:"none",cursor:"pointer"}},null,512),[[ne,o.color]])]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"排序"},{default:t(()=>[l(J,{modelValue:o.sort,"onUpdate:modelValue":e[8]||(e[8]=a=>o.sort=a),min:0},null,8,["modelValue"])]),_:1}),d.value?(c(),$(v,{key:0,label:"状态"},{default:t(()=>[l(Q,{modelValue:o.status,"onUpdate:modelValue":e[9]||(e[9]=a=>o.status=a)},{default:t(()=>[l(B,{value:"active"},{default:t(()=>[...e[18]||(e[18]=[u("启用",-1)])]),_:1}),l(B,{value:"inactive"},{default:t(()=>[...e[19]||(e[19]=[u("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):R("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header"])])}}}),ve=E(fe,[["__scopeId","data-v-77b5b5af"]]);export{ve as default};
