import{C as g,d as ae,r,l as le,b as i,c as K,e as A,h as e,w as l,i as v,p as ne,o as N,t as q,M as s,_ as oe}from"./index-BQBF81MK.js";const k={getAll(d,p,_){const c={};return d&&(c.stage=d),p&&(c.page=p),_&&(c.pageSize=_),g.get("/leads",{params:c})},getOne(d){return g.get(`/leads/${d}`)},create(d){return g.post("/leads",d)},update(d,p){return g.patch(`/leads/${d}`,p)},delete(d){return g.delete(`/leads/${d}`)},generateMock(d){return g.post("/leads/mock/generate",{count:d})},clearMock(){return g.delete("/leads/mock/clear")}},ie={class:"leads-page"},de={class:"page-header"},ue={key:1},se={class:"pagination-container"},re=ae({__name:"Leads",setup(d){const p=r([]),_=r(!1),c=r(""),w=r(!1),b=r(null),y=r(!1),L=r(10),m=r({current:1,pageSize:10,total:0}),o=r({leadName:"",contactInfo:"",stage:"uncontacted",intentionLevel:""}),B=[{colKey:"leadName",title:"线索名称",width:150},{colKey:"contactInfo",title:"联系方式",width:150},{colKey:"stage",title:"状态",width:120},{colKey:"intentionLevel",title:"意向等级",width:120},{colKey:"createdAt",title:"创建时间",width:180,cell:(a,{row:t})=>Q(t.createdAt)},{colKey:"action",title:"操作",width:150,fixed:"right"}],T=a=>({uncontacted:"未跟进",contacted:"跟进中",qualified:"已合格",converted:"已成交",invalid:"无效"})[a]||a,E=a=>({uncontacted:"default",contacted:"primary",qualified:"warning",converted:"success",invalid:"danger"})[a]||"default",O=a=>({low:"低",medium:"中",high:"高"})[a]||a,P=a=>({low:"default",medium:"warning",high:"danger"})[a]||"default",f=async()=>{_.value=!0;try{const a=await k.getAll(c.value,m.value.current,m.value.pageSize);p.value=a.data,m.value.total=a.total}catch{s.error("加载线索列表失败")}finally{_.value=!1}},j=()=>{f()},G=a=>{b.value=a,o.value={leadName:a.leadName,contactInfo:a.contactInfo,stage:a.stage,intentionLevel:a.intentionLevel||""},w.value=!0},F=async a=>{try{await k.delete(a),s.success("删除成功"),f()}catch{s.error("删除失败")}},H=async()=>{if(!o.value.leadName||!o.value.contactInfo){s.warning("请填写必填信息");return}try{const a={...o.value,intentionLevel:o.value.intentionLevel||void 0};b.value?(await k.update(b.value.id,a),s.success("更新成功")):(await k.create(a),s.success("创建成功")),w.value=!1,f()}catch{s.error(b.value?"更新失败":"创建失败")}},J=()=>{b.value=null,o.value={leadName:"",contactInfo:"",stage:"uncontacted",intentionLevel:""}},Q=a=>new Date(a).toLocaleString("zh-CN"),R=async()=>{try{const a=await k.generateMock(L.value);s.success(a.message),f()}catch{s.error("生成Mock数据失败")}},W=async()=>{try{const a=await k.clearMock();s.success(a.message),y.value=!1,f()}catch{s.error("清空数据失败")}},X=()=>{y.value=!1};return le(()=>{f()}),(a,t)=>{const u=i("t-option"),M=i("t-select"),C=i("t-icon"),V=i("t-button"),S=i("t-space"),I=i("t-tag"),x=i("t-link"),U=i("t-popconfirm"),Y=i("t-table"),Z=i("t-pagination"),z=i("t-input"),h=i("t-form-item"),D=i("t-form"),$=i("t-dialog"),ee=i("t-input-number");return N(),K("div",ie,[A("div",de,[e(S,null,{default:l(()=>[e(M,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=n=>c.value=n),placeholder:"筛选状态",clearable:"",style:{width:"200px"},onChange:f},{default:l(()=>[e(u,{value:"uncontacted",label:"未跟进"}),e(u,{value:"contacted",label:"跟进中"}),e(u,{value:"qualified",label:"已合格"}),e(u,{value:"converted",label:"已成交"}),e(u,{value:"invalid",label:"无效"})]),_:1},8,["modelValue"]),e(V,{theme:"primary",onClick:t[1]||(t[1]=n=>w.value=!0)},{icon:l(()=>[e(C,{name:"add"})]),default:l(()=>[t[12]||(t[12]=v(" 新建线索 ",-1))]),_:1}),e(V,{theme:"default",onClick:t[2]||(t[2]=n=>y.value=!0)},{icon:l(()=>[e(C,{name:"tools"})]),default:l(()=>[t[13]||(t[13]=v(" Mock数据 ",-1))]),_:1})]),_:1})]),e(Y,{data:p.value,columns:B,loading:_.value,"row-key":"id",stripe:"",hover:""},{stage:l(({row:n})=>[e(I,{theme:E(n.stage),variant:"light"},{default:l(()=>[v(q(T(n.stage)),1)]),_:2},1032,["theme"])]),intentionLevel:l(({row:n})=>[n.intentionLevel?(N(),ne(I,{key:0,theme:P(n.intentionLevel),variant:"light"},{default:l(()=>[v(q(O(n.intentionLevel)),1)]),_:2},1032,["theme"])):(N(),K("span",ue,"-"))]),action:l(({row:n})=>[e(S,null,{default:l(()=>[e(x,{theme:"primary",onClick:te=>G(n)},{default:l(()=>[...t[14]||(t[14]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(U,{content:"确定删除此线索吗？",onConfirm:te=>F(n.id)},{default:l(()=>[e(x,{theme:"danger"},{default:l(()=>[...t[15]||(t[15]=[v("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),A("div",se,[e(Z,{modelValue:m.value.current,"onUpdate:modelValue":t[3]||(t[3]=n=>m.value.current=n),pageSize:m.value.pageSize,"onUpdate:pageSize":t[4]||(t[4]=n=>m.value.pageSize=n),total:m.value.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",onChange:j},null,8,["modelValue","pageSize","total"])]),e($,{visible:w.value,"onUpdate:visible":t[9]||(t[9]=n=>w.value=n),header:b.value?"编辑线索":"新建线索",width:"600px",onConfirm:H,onClose:J},{default:l(()=>[e(D,{data:o.value,"label-align":"right","label-width":100},{default:l(()=>[e(h,{label:"线索名称",name:"leadName"},{default:l(()=>[e(z,{modelValue:o.value.leadName,"onUpdate:modelValue":t[5]||(t[5]=n=>o.value.leadName=n),placeholder:"请输入线索名称"},null,8,["modelValue"])]),_:1}),e(h,{label:"联系方式",name:"contactInfo"},{default:l(()=>[e(z,{modelValue:o.value.contactInfo,"onUpdate:modelValue":t[6]||(t[6]=n=>o.value.contactInfo=n),placeholder:"请输入联系方式"},null,8,["modelValue"])]),_:1}),e(h,{label:"状态",name:"stage"},{default:l(()=>[e(M,{modelValue:o.value.stage,"onUpdate:modelValue":t[7]||(t[7]=n=>o.value.stage=n),placeholder:"请选择状态"},{default:l(()=>[e(u,{value:"uncontacted",label:"未跟进"}),e(u,{value:"contacted",label:"跟进中"}),e(u,{value:"qualified",label:"已合格"}),e(u,{value:"converted",label:"已成交"}),e(u,{value:"invalid",label:"无效"})]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"意向等级",name:"intentionLevel"},{default:l(()=>[e(M,{modelValue:o.value.intentionLevel,"onUpdate:modelValue":t[8]||(t[8]=n=>o.value.intentionLevel=n),placeholder:"请选择意向等级",clearable:""},{default:l(()=>[e(u,{value:"low",label:"低"}),e(u,{value:"medium",label:"中"}),e(u,{value:"high",label:"高"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header"]),e($,{visible:y.value,"onUpdate:visible":t[11]||(t[11]=n=>y.value=n),header:"Mock数据管理",width:"500px",onConfirm:X},{default:l(()=>[e(D,{"label-align":"right","label-width":100},{default:l(()=>[e(h,{label:"生成数量"},{default:l(()=>[e(ee,{modelValue:L.value,"onUpdate:modelValue":t[10]||(t[10]=n=>L.value=n),min:1,max:100,placeholder:"请输入生成数量"},null,8,["modelValue"])]),_:1}),e(h,{label:"操作"},{default:l(()=>[e(S,null,{default:l(()=>[e(V,{theme:"primary",onClick:R},{icon:l(()=>[e(C,{name:"add"})]),default:l(()=>[t[16]||(t[16]=v(" 生成Mock数据 ",-1))]),_:1}),e(U,{content:"确定清空所有线索数据吗？此操作不可恢复！",onConfirm:W},{default:l(()=>[e(V,{theme:"danger"},{icon:l(()=>[e(C,{name:"delete"})]),default:l(()=>[t[17]||(t[17]=v(" 清空所有数据 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])])}}}),me=oe(re,[["__scopeId","data-v-2bb73b06"]]);export{me as default};
