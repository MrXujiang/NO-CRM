import{d as re,u as me,r as y,D as E,l as pe,b as i,c as G,e as n,h as t,w as l,i as d,p,m as T,o as m,t as x,M as f,_ as ce}from"./index-BQBF81MK.js";import{w as C}from"./workflow-C3Hchb8L.js";const fe={class:"workflows-page"},ve={class:"page-header"},ye={key:0},ge={style:{"text-align":"center"}},_e={style:{"font-size":"24px",color:"#0052d9"}},be={style:{"text-align":"center"}},ke={style:{"font-size":"24px",color:"#e37318"}},we={style:{"text-align":"center"}},Ve={style:{"font-size":"24px",color:"#00a870"}},xe={style:{"text-align":"center"}},Ce={style:{"font-size":"24px",color:"#0052d9"}},he={style:{"text-align":"center"}},Se={style:{"font-size":"24px",color:"#00a870"}},ze={style:{"text-align":"center"}},De={style:{"font-size":"24px",color:"#e37318"}},Ue=re({__name:"Workflows",setup(Ke){const U=me(),K=y(!1),j=y([]),M=y(""),$=y(""),h=y(!1),S=y(!1),I=y(!1),B=y(10),c=y(null),g=E({current:1,pageSize:10,total:0}),r=E({name:"",code:"",category:"approval",description:"",icon:"check-circle"}),O={name:[{required:!0,message:"请输入工作流名称"}],category:[{required:!0,message:"请选择分类"}]},F=[{colKey:"name",title:"工作流名称",width:180},{colKey:"code",title:"编码",width:150},{colKey:"category",title:"分类",width:120,cell:"category"},{colKey:"version",title:"版本",width:80},{colKey:"status",title:"状态",width:100,cell:"status"},{colKey:"isSystem",title:"类型",width:100,cell:"isSystem"},{colKey:"createdAt",title:"创建时间",width:160},{colKey:"action",title:"操作",width:280,cell:"action",fixed:"right"}],H=[{colKey:"status",title:"状态",width:150},{colKey:"count",title:"数量",width:150}],J=[{colKey:"type",title:"业务类型",width:150},{colKey:"count",title:"数量",width:150}],_=async()=>{var s,e;K.value=!0;try{const a=await C.getDefinitions(g.current,g.pageSize,M.value||void 0,$.value||void 0);j.value=a.data,g.total=a.total}catch(a){f.error(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"加载失败")}finally{K.value=!1}},L=()=>{_()},Q=()=>{Object.assign(r,{name:"",code:"",category:"approval",description:"",icon:"check-circle"}),h.value=!0},X=async()=>{var s,e;try{const a=await C.createDefinition(r);f.success("创建成功"),h.value=!1,U.push(`/workflow-designer?id=${a.id}`)}catch(a){f.error(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"创建失败")}},Y=s=>{U.push(`/workflow-designer?id=${s.id}`)},Z=async s=>{var e,a;try{await C.publishDefinition(s.id),f.success("发布成功"),_()}catch(b){f.error(((a=(e=b.response)==null?void 0:e.data)==null?void 0:a.message)||"发布失败")}},ee=async s=>{var e,a;try{await C.deleteDefinition(s),f.success("删除成功"),_()}catch(b){f.error(((a=(e=b.response)==null?void 0:e.data)==null?void 0:a.message)||"删除失败")}},te=s=>{U.push(`/workflow-instances?workflowId=${s.id}`)},le=async()=>{var s,e;try{c.value=await C.getStatistics(),I.value=!0}catch(a){f.error(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"加载统计失败")}},oe=async()=>{var s,e;try{const a=await C.generateMock(B.value);f.success(a.message),S.value=!1,_()}catch(a){f.error(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"生成失败")}};return pe(()=>{_()}),(s,e)=>{const a=i("t-icon"),b=i("t-button"),N=i("t-space"),u=i("t-option"),z=i("t-select"),k=i("t-card"),v=i("t-tag"),D=i("t-link"),ae=i("t-popconfirm"),P=i("t-table"),ne=i("t-pagination"),q=i("t-input"),w=i("t-form-item"),se=i("t-textarea"),A=i("t-form"),R=i("t-dialog"),ie=i("t-input-number"),de=i("t-alert"),V=i("t-col"),ue=i("t-row");return m(),G("div",fe,[n("div",ve,[e[16]||(e[16]=n("h2",null,"工作流管理",-1)),t(N,null,{default:l(()=>[t(b,{theme:"default",onClick:e[0]||(e[0]=o=>S.value=!0)},{icon:l(()=>[t(a,{name:"data"})]),default:l(()=>[e[14]||(e[14]=d(" Mock数据 ",-1))]),_:1}),t(b,{theme:"primary",onClick:Q},{icon:l(()=>[t(a,{name:"add"})]),default:l(()=>[e[15]||(e[15]=d(" 新建工作流 ",-1))]),_:1})]),_:1})]),t(k,{class:"filter-card"},{default:l(()=>[t(N,null,{default:l(()=>[t(z,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=o=>M.value=o),placeholder:"工作流分类",clearable:"",style:{width:"150px"},onChange:_},{default:l(()=>[t(u,{value:"approval",label:"审批流程"}),t(u,{value:"business",label:"业务流程"}),t(u,{value:"automation",label:"自动化"}),t(u,{value:"custom",label:"自定义"})]),_:1},8,["modelValue"]),t(z,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=o=>$.value=o),placeholder:"状态",clearable:"",style:{width:"120px"},onChange:_},{default:l(()=>[t(u,{value:"draft",label:"草稿"}),t(u,{value:"published",label:"已发布"}),t(u,{value:"archived",label:"已归档"})]),_:1},8,["modelValue"]),t(b,{theme:"default",onClick:le},{icon:l(()=>[t(a,{name:"chart-pie"})]),default:l(()=>[e[17]||(e[17]=d(" 查看统计 ",-1))]),_:1})]),_:1})]),_:1}),t(P,{data:j.value,columns:F,loading:K.value,"row-key":"id",stripe:"",hover:"",class:"data-table"},{category:l(({row:o})=>[o.category==="approval"?(m(),p(v,{key:0,theme:"primary"},{default:l(()=>[...e[18]||(e[18]=[d("审批流程",-1)])]),_:1})):o.category==="business"?(m(),p(v,{key:1,theme:"success"},{default:l(()=>[...e[19]||(e[19]=[d("业务流程",-1)])]),_:1})):o.category==="automation"?(m(),p(v,{key:2,theme:"warning"},{default:l(()=>[...e[20]||(e[20]=[d("自动化",-1)])]),_:1})):(m(),p(v,{key:3},{default:l(()=>[...e[21]||(e[21]=[d("自定义",-1)])]),_:1}))]),status:l(({row:o})=>[o.status==="draft"?(m(),p(v,{key:0,theme:"default"},{default:l(()=>[...e[22]||(e[22]=[d("草稿",-1)])]),_:1})):o.status==="published"?(m(),p(v,{key:1,theme:"success"},{default:l(()=>[...e[23]||(e[23]=[d("已发布",-1)])]),_:1})):(m(),p(v,{key:2,theme:"warning"},{default:l(()=>[...e[24]||(e[24]=[d("已归档",-1)])]),_:1}))]),isSystem:l(({row:o})=>[o.isSystem?(m(),p(v,{key:0,theme:"primary"},{default:l(()=>[...e[25]||(e[25]=[d("系统",-1)])]),_:1})):(m(),p(v,{key:1,theme:"default"},{default:l(()=>[...e[26]||(e[26]=[d("自定义",-1)])]),_:1}))]),action:l(({row:o})=>[t(N,null,{default:l(()=>[t(D,{theme:"primary",onClick:W=>Y(o)},{default:l(()=>[...e[27]||(e[27]=[d("设计",-1)])]),_:1},8,["onClick"]),o.status==="draft"?(m(),p(D,{key:0,theme:"success",onClick:W=>Z(o)},{default:l(()=>[...e[28]||(e[28]=[d(" 发布 ",-1)])]),_:1},8,["onClick"])):T("",!0),t(D,{onClick:W=>te(o)},{default:l(()=>[...e[29]||(e[29]=[d("实例记录",-1)])]),_:1},8,["onClick"]),!o.isSystem&&o.status==="draft"?(m(),p(ae,{key:1,content:"确认删除此工作流？",onConfirm:W=>ee(o.id)},{default:l(()=>[t(D,{theme:"danger"},{default:l(()=>[...e[30]||(e[30]=[d("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])):T("",!0)]),_:2},1024)]),_:1},8,["data","loading"]),t(ne,{modelValue:g.current,"onUpdate:modelValue":e[3]||(e[3]=o=>g.current=o),pageSize:g.pageSize,"onUpdate:pageSize":e[4]||(e[4]=o=>g.pageSize=o),total:g.total,"show-jumper":"",onChange:L},null,8,["modelValue","pageSize","total"]),t(R,{visible:h.value,"onUpdate:visible":e[10]||(e[10]=o=>h.value=o),header:"新建工作流",width:"600px",onConfirm:X},{default:l(()=>[t(A,{ref:"formRef",data:r,rules:O,"label-width":"100px"},{default:l(()=>[t(w,{label:"工作流名称",name:"name"},{default:l(()=>[t(q,{modelValue:r.name,"onUpdate:modelValue":e[5]||(e[5]=o=>r.name=o),placeholder:"请输入工作流名称"},null,8,["modelValue"])]),_:1}),t(w,{label:"工作流编码",name:"code"},{default:l(()=>[t(q,{modelValue:r.code,"onUpdate:modelValue":e[6]||(e[6]=o=>r.code=o),placeholder:"自动生成",disabled:""},null,8,["modelValue"])]),_:1}),t(w,{label:"分类",name:"category"},{default:l(()=>[t(z,{modelValue:r.category,"onUpdate:modelValue":e[7]||(e[7]=o=>r.category=o),placeholder:"请选择分类"},{default:l(()=>[t(u,{value:"approval",label:"审批流程"}),t(u,{value:"business",label:"业务流程"}),t(u,{value:"automation",label:"自动化流程"}),t(u,{value:"custom",label:"自定义流程"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"图标"},{default:l(()=>[t(z,{modelValue:r.icon,"onUpdate:modelValue":e[8]||(e[8]=o=>r.icon=o),placeholder:"选择图标"},{default:l(()=>[t(u,{value:"check-circle",label:"✓ 审批"}),t(u,{value:"swap",label:"⇄ 流转"}),t(u,{value:"time",label:"⏰ 定时"}),t(u,{value:"setting",label:"⚙ 自动化"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"描述"},{default:l(()=>[t(se,{modelValue:r.description,"onUpdate:modelValue":e[9]||(e[9]=o=>r.description=o),placeholder:"请输入工作流描述",maxlength:200},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"]),t(R,{visible:S.value,"onUpdate:visible":e[12]||(e[12]=o=>S.value=o),header:"生成 Mock 数据",onConfirm:oe},{default:l(()=>[t(A,null,{default:l(()=>[t(w,{label:"生成数量"},{default:l(()=>[t(ie,{modelValue:B.value,"onUpdate:modelValue":e[11]||(e[11]=o=>B.value=o),min:1,max:100},null,8,["modelValue"])]),_:1}),t(de,{theme:"info",message:"提示：将自动生成工作流定义和测试实例"})]),_:1})]),_:1},8,["visible"]),t(R,{visible:I.value,"onUpdate:visible":e[13]||(e[13]=o=>I.value=o),header:"工作流统计",width:"700px"},{default:l(()=>[c.value?(m(),G("div",ye,[t(ue,{gutter:16,style:{"margin-bottom":"20px"}},{default:l(()=>[t(V,{span:4},{default:l(()=>[t(k,null,{default:l(()=>[n("div",ge,[n("div",_e,x(c.value.totalInstances),1),e[31]||(e[31]=n("div",{style:{color:"#888"}},"总实例数",-1))])]),_:1})]),_:1}),t(V,{span:4},{default:l(()=>[t(k,null,{default:l(()=>[n("div",be,[n("div",ke,x(c.value.runningInstances),1),e[32]||(e[32]=n("div",{style:{color:"#888"}},"运行中",-1))])]),_:1})]),_:1}),t(V,{span:4},{default:l(()=>[t(k,null,{default:l(()=>[n("div",we,[n("div",Ve,x(c.value.completedInstances),1),e[33]||(e[33]=n("div",{style:{color:"#888"}},"已完成",-1))])]),_:1})]),_:1}),t(V,{span:4},{default:l(()=>[t(k,null,{default:l(()=>[n("div",xe,[n("div",Ce,x(c.value.avgDuration),1),e[34]||(e[34]=n("div",{style:{color:"#888"}},"平均耗时(分)",-1))])]),_:1})]),_:1}),t(V,{span:4},{default:l(()=>[t(k,null,{default:l(()=>[n("div",he,[n("div",Se,x(c.value.approvalRate)+"%",1),e[35]||(e[35]=n("div",{style:{color:"#888"}},"通过率",-1))])]),_:1})]),_:1}),t(V,{span:4},{default:l(()=>[t(k,null,{default:l(()=>[n("div",ze,[n("div",De,x(c.value.myPendingTasks),1),e[36]||(e[36]=n("div",{style:{color:"#888"}},"我的待办",-1))])]),_:1})]),_:1})]),_:1}),e[37]||(e[37]=n("h4",null,"按状态分布",-1)),t(P,{data:c.value.byStatus,columns:H,size:"small"},null,8,["data"]),e[38]||(e[38]=n("h4",{style:{"margin-top":"20px"}},"按业务类型分布",-1)),t(P,{data:c.value.byBusinessType,columns:J,size:"small"},null,8,["data"])])):T("",!0)]),_:1},8,["visible"])])}}}),Ie=ce(Ue,[["__scopeId","data-v-941df006"]]);export{Ie as default};
