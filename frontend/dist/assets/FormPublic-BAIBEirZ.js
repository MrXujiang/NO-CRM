import{d as j,j as A,r as u,k as p,l as L,M as k,b as r,c,h as o,n as x,e as d,m as O,t as v,w as l,o as n,F as G,f as H,p as J,q as K,i as C,_ as Q}from"./index-BQBF81MK.js";import{f as w}from"./form-HThWbM9f.js";import{F as W,a as X,_ as Y,b as g,c as Z,d as ee,e as te,f as ae,g as se,h as oe}from"./FormImage-CxTWCw98.js";const re={key:0,class:"loading-container"},le={class:"form-header"},ne={class:"form-title"},ie={key:0,class:"form-description"},ue={key:2,class:"error-container"},ce={class:"success-content"},de={class:"success-message"},me=j({__name:"FormPublic",setup(fe){const F=A(),a=u(null),i=u({}),y=u(!0),b=u(!1),f=u(!1),$=u(),S=F.params.shareUrl,V=p(()=>{var e;return a.value?{background:((e=a.value.config.style)==null?void 0:e.pageBackground)||"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}:{}}),B=p(()=>{var t;return a.value?{backgroundColor:((t=a.value.config.style)==null?void 0:t.backgroundColor)||"#ffffff"}:{}}),R=p(()=>{var e;if(!a.value)return{};const t=((e=a.value.config.style)==null?void 0:e.primaryColor)||"#0052d9";return{backgroundColor:t,borderColor:t}}),U=p(()=>{if(!a.value)return{};const t={};return a.value.config.components.forEach(e=>{e.required&&!["divider","description","image"].includes(e.type)&&(t[e.id]=[{required:!0,message:`请填写${e.label}`,type:"error"}])}),t}),D=t=>({input:g,textarea:oe,radio:se,checkbox:ae,select:te,date:ee,rate:Z,phone:g,email:g,divider:Y,description:X,image:W})[t]||g,M=async()=>{y.value=!0;try{a.value=await w.getByShareUrl(S),a.value.config.components.forEach(t=>{["divider","description","image"].includes(t.type)||(i.value[t.id]=t.type==="checkbox"?[]:"")})}catch(t){k.error(t.message||"加载表单失败"),a.value=null}finally{y.value=!1}},N=async({validateResult:t})=>{if(t===!0){b.value=!0;try{await w.submit(a.value.id,i.value),f.value=!0}catch(e){k.error(e.message||"提交失败")}finally{b.value=!1}}},z=()=>{var t,e;f.value=!1,(t=a.value)==null||t.config.components.forEach(m=>{["divider","description","image"].includes(m.type)||(i.value[m.id]=m.type==="checkbox"?[]:"")}),(e=$.value)==null||e.reset()};return L(()=>{if(!S){k.error("分享链接无效");return}M()}),(t,e)=>{const m=r("t-loading"),h=r("t-button"),E=r("t-form-item"),P=r("t-form"),q=r("t-result"),I=r("t-icon"),T=r("t-dialog");return n(),c("div",{class:"form-public-page",style:x(V.value)},[y.value?(n(),c("div",re,[o(m,{size:"large",text:"加载中..."})])):a.value?(n(),c("div",{key:1,class:"form-container",style:x(B.value)},[d("div",le,[d("h1",ne,v(a.value.title),1),a.value.description?(n(),c("p",ie,v(a.value.description),1)):O("",!0)]),o(P,{ref_key:"formRef",ref:$,data:i.value,rules:U.value,"label-width":"120px",onSubmit:N},{default:l(()=>[(n(!0),c(G,null,H(a.value.config.components,s=>(n(),J(K(D(s.type)),{key:s.id,component:s,modelValue:i.value[s.id],"onUpdate:modelValue":_=>i.value[s.id]=_},null,8,["component","modelValue","onUpdate:modelValue"]))),128)),o(E,{style:{"margin-top":"32px"}},{default:l(()=>[o(h,{theme:"primary",type:"submit",block:"",size:"large",loading:b.value,style:x(R.value)},{default:l(()=>{var s;return[C(v(((s=a.value.config.settings)==null?void 0:s.submitButtonText)||"提交"),1)]}),_:1},8,["loading","style"])]),_:1})]),_:1},8,["data","rules"]),e[2]||(e[2]=d("div",{class:"form-footer"},[d("span",null,"Powered by NO-CRM")],-1))],4)):(n(),c("div",ue,[o(q,{theme:"error",title:"表单不存在",description:"该表单可能已被删除或未发布"},{extra:l(()=>[o(h,{theme:"primary",onClick:e[0]||(e[0]=s=>t.$router.push("/"))},{default:l(()=>[...e[3]||(e[3]=[C("返回首页",-1)])]),_:1})]),_:1})])),o(T,{visible:f.value,"onUpdate:visible":e[1]||(e[1]=s=>f.value=s),header:"提交成功",footer:!1,width:"400px"},{default:l(()=>{var s,_;return[d("div",ce,[o(I,{name:"check-circle",size:"64px",style:{color:"#52c41a"}}),d("p",de,v(((_=(s=a.value)==null?void 0:s.config.settings)==null?void 0:_.successMessage)||"感谢您的提交！"),1),o(h,{theme:"primary",onClick:z},{default:l(()=>[...e[4]||(e[4]=[C("再次填写",-1)])]),_:1})])]}),_:1},8,["visible"])],4)}}}),ge=Q(me,[["__scopeId","data-v-483bc96a"]]);export{ge as default};
