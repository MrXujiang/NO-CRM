import{d as dt,j as ut,u as rt,D as ct,r as m,k as pt,l as vt,b,c as v,e as i,h as l,w as a,i as y,t as h,p as Y,m as k,o as r,F as x,f as P,n as Ve,v as z,g as ft,M as $,y as mt,T as gt,_ as yt}from"./index-BQBF81MK.js";import{w as ne}from"./workflow-C3Hchb8L.js";const _t={class:"workflow-designer"},bt={class:"designer-toolbar"},kt={class:"workflow-title"},ht={class:"designer-content"},wt={class:"nodes-panel"},xt={class:"node-group"},Vt=["onDragstart"],$t={class:"node-group"},Mt=["onDragstart"],Ct={class:"node-group"},Dt=["onDragstart"],Ut={class:"canvas-area"},Tt={class:"canvas-toolbar"},Nt=["width","height"],Rt=["width","height"],St=["d"],Pt=["width","height"],zt=["d"],Et=["d"],Yt=["d","stroke","stroke-width","marker-end","onClick","onMouseenter","onMouseleave"],Ot=["x","y","width"],Bt=["x","y"],Wt={key:2,class:"edge-delete-btn"},Gt=["cx","cy","onClick"],Xt=["x","y"],At=["onClick","onMousedown"],Ht={class:"node-content"},Lt={class:"node-header"},jt={class:"node-icon"},qt={class:"node-info"},Ft={class:"node-name"},It={class:"node-type"},Kt=["title"],Zt=["onMousedown","onMouseenter","onMouseleave"],Jt=["onMousedown","onMouseenter","onMouseleave"],Qt={key:0,class:"node-menu"},el=["onClick"],tl=["onClick"],ll={key:0,class:"node-badge required"},ol={key:1,class:"node-badge timer"},al={key:0,class:"empty-canvas"},nl={class:"properties-panel"},sl={class:"panel-title"},il={key:0,class:"properties-content"},dl={key:1,class:"properties-content"},ul={class:"preview-container"},rl={class:"preview-info"},cl={class:"preview-canvas"},pl={class:"preview-workflow"},vl={width:800,height:600,style:{border:"1px solid #e7e7e7",background:"#fafafa"}},fl=["d"],ml=["x","y","fill"],gl=["x","y"],yl={class:"preview-nodes"},_l=dt({__name:"WorkflowDesigner",setup(bl){const $e=ut(),Me=rt(),s=ct({id:"",name:"",code:"",category:"approval",description:"",icon:"check-circle",version:1,nodes:[],edges:[],variables:[],status:"draft",isSystem:!1,createdBy:"",createdAt:"",updatedAt:""}),c=m(null),U=m(null),Z=m(!1),J=m(!1),Q=m(null),L=m(""),ee=m("user"),se=m(1);m("");const ie=m(""),de=m("call"),ue=m("initiator"),re=m(["system"]),ce=m(""),pe=m(""),ve=m("POST"),j=m(),M=m(1),fe=m(3e3),me=m(2e3),T=m(20),O=m(null),te=m({x:0,y:0}),le=m(!1),W=m(!1),N=m(null),q=m(""),G=m({x:0,y:0});let ge=0;const Ce=[{type:"start",label:"开始",icon:"play-circle"},{type:"end",label:"结束",icon:"stop-circle"}],De=[{type:"approval",label:"审批",icon:"check-circle"}],Ue=[{type:"condition",label:"条件判断",icon:"fork"},{type:"parallel",label:"并行分支",icon:"fork"},{type:"action",label:"执行动作",icon:"play"}],Te=pt(()=>s.nodes.filter(o=>{var e;return o.id!==((e=Q.value)==null?void 0:e.id)})),Ne=[{colKey:"name",title:"节点名称",width:150},{colKey:"type",title:"节点类型",width:120},{colKey:"description",title:"描述",ellipsis:!0}],Re=o=>({approval:"审批流程",business:"业务流程",automation:"自动化",custom:"自定义"})[o]||o,Se=o=>({start:"#52c41a",end:"#f5222d",approval:"#1890ff",condition:"#faad14",parallel:"#722ed1",action:"#13c2c2"})[o]||"#666",Pe=o=>{const e=s.nodes.find(u=>u.id===o.source),n=s.nodes.find(u=>u.id===o.target);if(!e||!n)return"";const d=e.position.x*.25+25,g=e.position.y*.25+30,_=n.position.x*.25+25,f=n.position.y*.25;return`M ${d} ${g} L ${_} ${f}`},ze=o=>({start:"play-circle",end:"stop-circle",approval:"check-circle",condition:"fork",parallel:"fork",action:"play"})[o]||"bulletpoint",ye=o=>({start:"开始节点",end:"结束节点",approval:"审批节点",condition:"条件节点",parallel:"并行节点",action:"动作节点"})[o]||o,oe=(o,e)=>{o.dataTransfer.effectAllowed="copy",o.dataTransfer.setData("nodeType",JSON.stringify(e))},Ee=o=>{o.preventDefault();const e=JSON.parse(o.dataTransfer.getData("nodeType")),d=o.currentTarget.getBoundingClientRect(),g=o.clientX-d.left-100,_=o.clientY-d.top-40,f={id:`node_${++ge}_${Date.now()}`,type:e.type,name:e.label,position:{x:g,y:_},config:e.type==="approval"?{approvalMode:"single",allowReject:!0,timeout:24}:{}};s.nodes.push(f),$.success(`已添加${e.label}节点`)},Ye=o=>{c.value=o,U.value=null},Oe=o=>{U.value=o,c.value=null},_e=(o,e)=>{e&&console.log("Edge hover:",o.id)},Be=o=>{const e=s.edges.findIndex(n=>n.id===o);e>-1&&(s.edges.splice(e,1),U.value=null,$.success("连线已删除"))},We=(o,e)=>{var d;O.value=e,le.value=!0,o.currentTarget.getBoundingClientRect();const n=(d=j.value)==null?void 0:d.getBoundingClientRect();n&&(te.value={x:(o.clientX-n.left)/M.value-e.position.x,y:(o.clientY-n.top)/M.value-e.position.y})},Ge=o=>{var e,n;if(le.value&&O.value){const d=(e=j.value)==null?void 0:e.getBoundingClientRect();if(d){const g=(o.clientX-d.left)/M.value-te.value.x,_=(o.clientY-d.top)/M.value-te.value.y;O.value.position.x=Math.round(g/T.value)*T.value,O.value.position.y=Math.round(_/T.value)*T.value}}else if(W.value&&N.value){const d=(n=j.value)==null?void 0:n.getBoundingClientRect();if(d){G.value={x:(o.clientX-d.left)/M.value,y:(o.clientY-d.top)/M.value};const g=N.value.position.x+100,_=N.value.position.y+100,f=G.value.x,u=G.value.y,p=Math.abs(u-_),w=Math.min(p*.5,80),S=_+w,C=u-w;q.value=`M ${g} ${_} C ${g} ${S}, ${f} ${C}, ${f} ${u}`}}},Xe=()=>{if(W.value&&N.value){const o=Le(G.value.x,G.value.y);o&&o.id!==N.value.id&&je(N.value,o)}le.value=!1,O.value=null,W.value=!1,N.value=null,q.value=""},Ae=o=>{o.target===o.currentTarget&&(c.value=null,U.value=null)},be=(o,e,n)=>{n==="output"&&(W.value=!0,N.value=e,o.stopPropagation())},F=(o,e,n)=>{console.log(`Port ${e} of ${o.name} hover: ${n}`)},He=o=>{c.value=o,$.info("请在右侧属性面板编辑节点")},Le=(o,e)=>s.nodes.find(n=>{const d=n.position.x,g=n.position.y;return o>=d&&o<=d+200&&e>=g&&e<=g+100})||null,je=(o,e)=>{if(!s.edges.some(d=>d.source===o.id&&d.target===e.id)){const d={id:`edge_${Date.now()}`,source:o.id,target:e.id};s.edges.push(d),$.success("连线已创建")}},qe=o=>{const e=s.nodes[o].id;s.edges=s.edges.filter(n=>n.source!==e&&n.target!==e),s.nodes.splice(o,1),c.value=null,$.success("节点已删除")},Fe=()=>{if(!Q.value||!L.value)return;const o={id:`edge_${Date.now()}`,source:Q.value.id,target:L.value};s.edges.push(o),Z.value=!1,$.success("连线已创建")},ke=o=>{const e=s.nodes.find(C=>C.id===o.source),n=s.nodes.find(C=>C.id===o.target);if(!e||!n)return"";const d=e.position.x+100,g=e.position.y+100,_=n.position.x+100,f=n.position.y,u=Math.abs(f-g),p=Math.min(u*.5,80),w=g+p,S=f-p;if(Math.abs(_-d)>100)return`M ${d} ${g} C ${d} ${w}, ${_} ${S}, ${_} ${f}`;{const C=(g+f)/2;return`M ${d} ${g} C ${d} ${C}, ${_} ${C}, ${_} ${f}`}},R=o=>{const e=s.nodes.find(u=>u.id===o.source),n=s.nodes.find(u=>u.id===o.target);if(!e||!n)return{x:0,y:0};const d=e.position.x+100,g=e.position.y+100,_=n.position.x+100,f=n.position.y;return{x:(d+_)/2,y:(g+f)/2}},Ie=()=>{Me.back()},Ke=async()=>{var o,e;try{await ne.updateDefinition(s.id,{name:s.name,description:s.description,category:s.category,nodes:s.nodes,edges:s.edges,variables:s.variables}),$.success("保存成功")}catch(n){$.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||"保存失败")}},Ze=async()=>{var o,e;try{await ne.publishDefinition(s.id),$.success("发布成功"),he()}catch(n){$.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||"发布失败")}},Je=()=>{J.value=!0},Qe=()=>{M.value=Math.min(M.value+.1,2)},et=()=>{M.value=Math.max(M.value-.1,.5)},tt=()=>{M.value=1},lt=()=>{const o=s.nodes.find(d=>d.type==="start");if(!o){$.warning("请先添加开始节点");return}const e=new Set,n=(d,g,_)=>{if(e.has(d))return;e.add(d);const f=s.nodes.find(p=>p.id===d);if(!f)return;f.position.x=100+_*250,f.position.y=100+g*150,s.edges.filter(p=>p.source===d).forEach((p,w)=>{n(p.target,g+1,_+w)})};n(o.id,0,0),$.success("自动布局完成")},he=async()=>{var e,n;const o=$e.query.id;if(o)try{const d=await ne.getDefinition(o);Object.assign(s,d),ge=s.nodes.length}catch(d){$.error(((n=(e=d.response)==null?void 0:e.data)==null?void 0:n.message)||"加载失败")}};return vt(()=>{he()}),(o,e)=>{const n=b("t-icon"),d=b("t-button"),g=b("t-space"),_=b("t-tooltip"),f=b("t-input"),u=b("t-form-item"),p=b("t-option"),w=b("t-select"),S=b("t-textarea"),C=b("t-tag"),we=b("t-form"),I=b("t-divider"),K=b("t-input-number"),ot=b("t-switch"),ae=b("t-checkbox"),at=b("t-checkbox-group"),xe=b("t-dialog"),E=b("t-descriptions-item"),nt=b("t-descriptions"),st=b("t-table");return r(),v("div",_t,[i("div",bt,[l(g,null,{default:a(()=>[l(d,{theme:"default",onClick:Ie},{icon:a(()=>[l(n,{name:"arrow-left"})]),default:a(()=>[e[28]||(e[28]=y(" 返回 ",-1))]),_:1}),i("span",kt,h(s.name||"工作流设计"),1)]),_:1}),l(g,null,{default:a(()=>[l(d,{theme:"default",onClick:Je},{icon:a(()=>[l(n,{name:"view-module"})]),default:a(()=>[e[29]||(e[29]=y(" 预览 ",-1))]),_:1}),l(d,{theme:"primary",onClick:Ke},{icon:a(()=>[l(n,{name:"save"})]),default:a(()=>[e[30]||(e[30]=y(" 保存 ",-1))]),_:1}),s.status==="draft"?(r(),Y(d,{key:0,theme:"success",onClick:Ze},{icon:a(()=>[l(n,{name:"check-circle"})]),default:a(()=>[e[31]||(e[31]=y(" 发布 ",-1))]),_:1})):k("",!0)]),_:1})]),i("div",ht,[i("div",wt,[e[35]||(e[35]=i("div",{class:"panel-title"},"节点组件",-1)),i("div",xt,[e[32]||(e[32]=i("div",{class:"group-title"},"基础节点",-1)),(r(),v(x,null,P(Ce,t=>i("div",{key:t.type,class:"node-item",draggable:"true",onDragstart:D=>oe(D,t)},[l(n,{name:t.icon},null,8,["name"]),i("span",null,h(t.label),1)],40,Vt)),64))]),i("div",$t,[e[33]||(e[33]=i("div",{class:"group-title"},"审批节点",-1)),(r(),v(x,null,P(De,t=>i("div",{key:t.type,class:"node-item",draggable:"true",onDragstart:D=>oe(D,t)},[l(n,{name:t.icon},null,8,["name"]),i("span",null,h(t.label),1)],40,Mt)),64))]),i("div",Ct,[e[34]||(e[34]=i("div",{class:"group-title"},"高级节点",-1)),(r(),v(x,null,P(Ue,t=>i("div",{key:t.type,class:"node-item",draggable:"true",onDragstart:D=>oe(D,t)},[l(n,{name:t.icon},null,8,["name"]),i("span",null,h(t.label),1)],40,Dt)),64))])]),i("div",Ut,[i("div",Tt,[l(g,null,{default:a(()=>[l(d,{size:"small",variant:"outline",onClick:Qe},{icon:a(()=>[l(n,{name:"add"})]),default:a(()=>[e[36]||(e[36]=y(" 放大 ",-1))]),_:1}),l(d,{size:"small",variant:"outline",onClick:et},{icon:a(()=>[l(n,{name:"remove"})]),default:a(()=>[e[37]||(e[37]=y(" 缩小 ",-1))]),_:1}),l(d,{size:"small",variant:"outline",onClick:tt},{icon:a(()=>[l(n,{name:"refresh"})]),default:a(()=>[e[38]||(e[38]=y(" 重置 ",-1))]),_:1}),l(d,{size:"small",variant:"outline",onClick:lt},{icon:a(()=>[l(n,{name:"view-module"})]),default:a(()=>[e[39]||(e[39]=y(" 自动布局 ",-1))]),_:1})]),_:1})]),i("div",{ref_key:"canvasRef",ref:j,class:"canvas-wrapper",onDrop:Ee,onDragover:e[0]||(e[0]=z(()=>{},["prevent"])),onMousedown:Ae,onMousemove:Ge,onMouseup:Xe,style:Ve({transform:`scale(${M.value})`,transformOrigin:"top left"})},[(r(),v("svg",{class:"canvas-grid",width:fe.value,height:me.value},[i("defs",null,[i("pattern",{id:"grid",width:T.value,height:T.value,patternUnits:"userSpaceOnUse"},[i("path",{d:`M ${T.value} 0 L 0 0 0 ${T.value}`,fill:"none",stroke:"#e0e0e0","stroke-width":"1"},null,8,St)],8,Rt)]),e[40]||(e[40]=i("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))],8,Nt)),(r(),v("svg",{class:"workflow-edges",width:fe.value,height:me.value},[e[41]||(e[41]=ft('<defs data-v-efa96e1d><marker id="arrowhead" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" data-v-efa96e1d><polygon points="0 0, 8 3, 0 6" fill="#0052d9" data-v-efa96e1d></polygon></marker><marker id="arrowhead-selected" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" data-v-efa96e1d><polygon points="0 0, 8 3, 0 6" fill="#e34d59" data-v-efa96e1d></polygon></marker><linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%" data-v-efa96e1d><stop offset="0%" style="stop-color:#0052d9;stop-opacity:0.8;" data-v-efa96e1d></stop><stop offset="100%" style="stop-color:#0052d9;stop-opacity:1;" data-v-efa96e1d></stop></linearGradient><linearGradient id="lineGradientSelected" x1="0%" y1="0%" x2="100%" y2="0%" data-v-efa96e1d><stop offset="0%" style="stop-color:#e34d59;stop-opacity:0.8;" data-v-efa96e1d></stop><stop offset="100%" style="stop-color:#e34d59;stop-opacity:1;" data-v-efa96e1d></stop></linearGradient></defs>',1)),W.value&&q.value?(r(),v("path",{key:0,d:q.value,stroke:"#0052d9","stroke-width":"3","stroke-dasharray":"8,4",fill:"none",opacity:"0.6"},null,8,zt)):k("",!0),(r(!0),v(x,null,P(s.edges,t=>{var D,X,A,H;return r(),v("g",{key:t.id},[i("path",{d:ke(t),stroke:"rgba(0, 0, 0, 0.1)","stroke-width":"6",fill:"none",transform:"translate(0, 2)"},null,8,Et),i("path",{d:ke(t),stroke:((D=U.value)==null?void 0:D.id)===t.id?"url(#lineGradientSelected)":"url(#lineGradient)","stroke-width":((X=U.value)==null?void 0:X.id)===t.id?4:3,fill:"none","marker-end":((A=U.value)==null?void 0:A.id)===t.id?"url(#arrowhead-selected)":"url(#arrowhead)",class:"edge-path",onClick:B=>Oe(t),onMouseenter:B=>_e(t,!0),onMouseleave:B=>_e(t,!1)},null,40,Yt),t.label?(r(),v("rect",{key:0,x:R(t).x-t.label.length*3.5,y:R(t).y-10,width:t.label.length*7,height:"20",rx:"4",fill:"white",stroke:"#e0e0e0","stroke-width":"1"},null,8,Ot)):k("",!0),t.label?(r(),v("text",{key:1,x:R(t).x,y:R(t).y+4,"text-anchor":"middle","font-size":"12",fill:"#666","font-weight":"500"},h(t.label),9,Bt)):k("",!0),((H=U.value)==null?void 0:H.id)===t.id?(r(),v("g",Wt,[i("circle",{cx:R(t).x,cy:R(t).y-25,r:"12",fill:"#f5222d",onClick:z(B=>Be(t.id),["stop"]),style:{cursor:"pointer"}},null,8,Gt),i("text",{x:R(t).x,y:R(t).y-21,"text-anchor":"middle","font-size":"14",fill:"white","font-weight":"bold",style:{"pointer-events":"none"}}," × ",8,Xt)])):k("",!0)])}),128))],8,Pt)),(r(!0),v(x,null,P(s.nodes,(t,D)=>{var X,A,H,B;return r(),v("div",{key:t.id,class:mt(["workflow-node",{active:((X=c.value)==null?void 0:X.id)===t.id,dragging:((A=O.value)==null?void 0:A.id)===t.id,[t.type]:!0}]),style:Ve({left:t.position.x+"px",top:t.position.y+"px"}),onClick:z(V=>Ye(t),["stop"]),onMousedown:z(V=>We(V,t),["stop"])},[i("div",Ht,[i("div",Lt,[i("div",jt,[l(n,{name:ze(t.type),size:"20px"},null,8,["name"])]),i("div",qt,[i("div",Ft,h(t.name),1),i("div",It,h(ye(t.type)),1)])]),t.description?(r(),v("div",{key:0,class:"node-desc",title:t.description},h(t.description),9,Kt)):k("",!0)]),i("div",{class:"node-port port-input",onMousedown:z(V=>be(V,t,"input"),["stop"]),onMouseenter:V=>F(t,"input",!0),onMouseleave:V=>F(t,"input",!1)},[...e[42]||(e[42]=[i("div",{class:"port-dot"},null,-1)])],40,Zt),i("div",{class:"node-port port-output",onMousedown:z(V=>be(V,t,"output"),["stop"]),onMouseenter:V=>F(t,"output",!0),onMouseleave:V=>F(t,"output",!1)},[...e[43]||(e[43]=[i("div",{class:"port-dot"},null,-1)])],40,Jt),l(gt,{name:"fade"},{default:a(()=>{var V;return[((V=c.value)==null?void 0:V.id)===t.id?(r(),v("div",Qt,[l(_,{content:"编辑节点"},{default:a(()=>[i("div",{class:"menu-item",onClick:z(it=>He(t),["stop"])},[l(n,{name:"edit"})],8,el)]),_:2},1024),l(_,{content:"删除节点"},{default:a(()=>[i("div",{class:"menu-item danger",onClick:z(it=>qe(D),["stop"])},[l(n,{name:"delete"})],8,tl)]),_:2},1024)])):k("",!0)]}),_:2},1024),(H=t.config)!=null&&H.required?(r(),v("div",ll,[l(n,{name:"error-circle",size:"14px"})])):k("",!0),t.type==="approval"&&((B=t.config)!=null&&B.timeout)?(r(),v("div",ol,[l(n,{name:"time",size:"14px"})])):k("",!0)],46,At)}),128)),s.nodes.length===0?(r(),v("div",al,[l(n,{name:"layers",size:"64px"}),e[44]||(e[44]=i("p",null,"从左侧拖拽节点到画布开始设计工作流",-1))])):k("",!0)],36)]),i("div",nl,[i("div",sl,h(c.value?"节点属性":"工作流属性"),1),c.value?(r(),v("div",dl,[l(we,{"label-width":"80px"},{default:a(()=>[l(u,{label:"节点名称"},{default:a(()=>[l(f,{modelValue:c.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value.name=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"节点类型"},{default:a(()=>[l(f,{value:ye(c.value.type),disabled:""},null,8,["value"])]),_:1}),l(u,{label:"描述"},{default:a(()=>[l(S,{modelValue:c.value.description,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value.description=t),maxlength:200},null,8,["modelValue"])]),_:1}),c.value.type==="approval"?(r(),v(x,{key:0},[l(I,null,{default:a(()=>[...e[48]||(e[48]=[y("审批配置",-1)])]),_:1}),l(u,{label:"审批模式"},{default:a(()=>[l(w,{modelValue:c.value.config.approvalMode,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.config.approvalMode=t)},{default:a(()=>[l(p,{value:"single",label:"单人审批"}),l(p,{value:"multi",label:"多人审批"}),l(p,{value:"sequential",label:"依次审批"}),l(p,{value:"countersign",label:"会签"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"审批人类型"},{default:a(()=>[l(w,{modelValue:ee.value,"onUpdate:modelValue":e[8]||(e[8]=t=>ee.value=t)},{default:a(()=>[l(p,{value:"user",label:"指定用户"}),l(p,{value:"role",label:"指定角色"}),l(p,{value:"department",label:"指定部门"}),l(p,{value:"initiator_leader",label:"发起人领导"})]),_:1},8,["modelValue"])]),_:1}),ee.value==="initiator_leader"?(r(),Y(u,{key:0,label:"领导层级"},{default:a(()=>[l(K,{modelValue:se.value,"onUpdate:modelValue":e[9]||(e[9]=t=>se.value=t),min:1,max:5},null,8,["modelValue"])]),_:1})):k("",!0),l(u,{label:"允许驳回"},{default:a(()=>[l(ot,{modelValue:c.value.config.allowReject,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value.config.allowReject=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"超时时间"},{default:a(()=>[l(K,{modelValue:c.value.config.timeout,"onUpdate:modelValue":e[11]||(e[11]=t=>c.value.config.timeout=t),min:0,suffix:"小时"},null,8,["modelValue"])]),_:1})],64)):k("",!0),c.value.type==="condition"?(r(),v(x,{key:1},[l(I,null,{default:a(()=>[...e[49]||(e[49]=[y("条件配置",-1)])]),_:1}),l(u,{label:"条件表达式"},{default:a(()=>[l(S,{modelValue:c.value.config.expression,"onUpdate:modelValue":e[12]||(e[12]=t=>c.value.config.expression=t),placeholder:"例如: ${amount} > 10000",maxlength:500,autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),e[50]||(e[50]=i("div",{style:{"font-size":"12px",color:"#888","margin-top":"4px"}}," 可用变量: ${amount}, ${totalAmount}, ${status}, ${customerId} ",-1))]),_:1}),l(u,{label:"条件说明"},{default:a(()=>[l(f,{modelValue:c.value.config.conditionDesc,"onUpdate:modelValue":e[13]||(e[13]=t=>c.value.config.conditionDesc=t),placeholder:"条件描述"},null,8,["modelValue"])]),_:1})],64)):k("",!0),c.value.type==="parallel"?(r(),v(x,{key:2},[l(I,null,{default:a(()=>[...e[51]||(e[51]=[y("并行配置",-1)])]),_:1}),l(u,{label:"并行模式"},{default:a(()=>[l(w,{modelValue:c.value.config.parallelMode,"onUpdate:modelValue":e[14]||(e[14]=t=>c.value.config.parallelMode=t)},{default:a(()=>[l(p,{value:"all",label:"会签(所有分支通过)"}),l(p,{value:"any",label:"或签(任一分支通过)"}),l(p,{value:"ratio",label:"按比例通过"})]),_:1},8,["modelValue"])]),_:1}),c.value.config.parallelMode==="ratio"?(r(),Y(u,{key:0,label:"通过比例"},{default:a(()=>[l(K,{modelValue:c.value.config.passRatio,"onUpdate:modelValue":e[15]||(e[15]=t=>c.value.config.passRatio=t),min:1,max:100,suffix:"%"},null,8,["modelValue"])]),_:1})):k("",!0),l(u,{label:"分支数量"},{default:a(()=>[l(K,{modelValue:c.value.config.branchCount,"onUpdate:modelValue":e[16]||(e[16]=t=>c.value.config.branchCount=t),min:2,max:10},null,8,["modelValue"])]),_:1})],64)):k("",!0),c.value.type==="action"?(r(),v(x,{key:3},[l(I,null,{default:a(()=>[...e[52]||(e[52]=[y("动作配置",-1)])]),_:1}),l(u,{label:"动作类型"},{default:a(()=>[l(w,{modelValue:c.value.config.actionType,"onUpdate:modelValue":e[17]||(e[17]=t=>c.value.config.actionType=t)},{default:a(()=>[l(p,{value:"create_task",label:"创建任务"}),l(p,{value:"send_notification",label:"发送通知"}),l(p,{value:"update_data",label:"更新数据"}),l(p,{value:"webhook",label:"调用Webhook"})]),_:1},8,["modelValue"])]),_:1}),c.value.config.actionType==="create_task"?(r(),v(x,{key:0},[l(u,{label:"任务标题"},{default:a(()=>[l(f,{modelValue:ie.value,"onUpdate:modelValue":e[18]||(e[18]=t=>ie.value=t),placeholder:"例如: 完成${businessType}跟进"},null,8,["modelValue"])]),_:1}),l(u,{label:"任务类型"},{default:a(()=>[l(w,{modelValue:de.value,"onUpdate:modelValue":e[19]||(e[19]=t=>de.value=t)},{default:a(()=>[l(p,{value:"call",label:"电话"}),l(p,{value:"visit",label:"拜访"}),l(p,{value:"email",label:"邮件"}),l(p,{value:"other",label:"其他"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"负责人"},{default:a(()=>[l(w,{modelValue:ue.value,"onUpdate:modelValue":e[20]||(e[20]=t=>ue.value=t),placeholder:"选择负责人"},{default:a(()=>[l(p,{value:"initiator",label:"流程发起人"}),l(p,{value:"custom",label:"指定人员"})]),_:1},8,["modelValue"])]),_:1})],64)):k("",!0),c.value.config.actionType==="send_notification"?(r(),v(x,{key:1},[l(u,{label:"通知方式"},{default:a(()=>[l(at,{modelValue:re.value,"onUpdate:modelValue":e[21]||(e[21]=t=>re.value=t)},{default:a(()=>[l(ae,{value:"email"},{default:a(()=>[...e[53]||(e[53]=[y("邮件",-1)])]),_:1}),l(ae,{value:"sms"},{default:a(()=>[...e[54]||(e[54]=[y("短信",-1)])]),_:1}),l(ae,{value:"system"},{default:a(()=>[...e[55]||(e[55]=[y("系统消息",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"通知内容"},{default:a(()=>[l(S,{modelValue:ce.value,"onUpdate:modelValue":e[22]||(e[22]=t=>ce.value=t),placeholder:"通知内容模板",maxlength:500},null,8,["modelValue"])]),_:1})],64)):k("",!0),c.value.config.actionType==="webhook"?(r(),v(x,{key:2},[l(u,{label:"Webhook URL"},{default:a(()=>[l(f,{modelValue:pe.value,"onUpdate:modelValue":e[23]||(e[23]=t=>pe.value=t),placeholder:"https://api.example.com/webhook"},null,8,["modelValue"])]),_:1}),l(u,{label:"请求方法"},{default:a(()=>[l(w,{modelValue:ve.value,"onUpdate:modelValue":e[24]||(e[24]=t=>ve.value=t)},{default:a(()=>[l(p,{value:"POST",label:"POST"}),l(p,{value:"GET",label:"GET"}),l(p,{value:"PUT",label:"PUT"})]),_:1},8,["modelValue"])]),_:1})],64)):k("",!0)],64)):k("",!0)]),_:1})])):(r(),v("div",il,[l(we,{"label-width":"80px"},{default:a(()=>[l(u,{label:"名称"},{default:a(()=>[l(f,{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=t=>s.name=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"编码"},{default:a(()=>[l(f,{modelValue:s.code,"onUpdate:modelValue":e[2]||(e[2]=t=>s.code=t),disabled:""},null,8,["modelValue"])]),_:1}),l(u,{label:"分类"},{default:a(()=>[l(w,{modelValue:s.category,"onUpdate:modelValue":e[3]||(e[3]=t=>s.category=t)},{default:a(()=>[l(p,{value:"approval",label:"审批流程"}),l(p,{value:"business",label:"业务流程"}),l(p,{value:"automation",label:"自动化"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"描述"},{default:a(()=>[l(S,{modelValue:s.description,"onUpdate:modelValue":e[4]||(e[4]=t=>s.description=t),maxlength:200},null,8,["modelValue"])]),_:1}),l(u,{label:"版本"},{default:a(()=>[l(f,{value:s.version,disabled:""},null,8,["value"])]),_:1}),l(u,{label:"状态"},{default:a(()=>[s.status==="draft"?(r(),Y(C,{key:0,theme:"default"},{default:a(()=>[...e[45]||(e[45]=[y("草稿",-1)])]),_:1})):s.status==="published"?(r(),Y(C,{key:1,theme:"success"},{default:a(()=>[...e[46]||(e[46]=[y("已发布",-1)])]),_:1})):(r(),Y(C,{key:2,theme:"warning"},{default:a(()=>[...e[47]||(e[47]=[y("已归档",-1)])]),_:1}))]),_:1})]),_:1})]))])]),l(xe,{visible:Z.value,"onUpdate:visible":e[26]||(e[26]=t=>Z.value=t),header:"连接到节点",onConfirm:Fe},{default:a(()=>[l(w,{modelValue:L.value,"onUpdate:modelValue":e[25]||(e[25]=t=>L.value=t),placeholder:"选择目标节点"},{default:a(()=>[(r(!0),v(x,null,P(Te.value,t=>(r(),Y(p,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),l(xe,{visible:J.value,"onUpdate:visible":e[27]||(e[27]=t=>J.value=t),header:"流程预览",width:"80%",footer:!1},{default:a(()=>[i("div",ul,[i("div",rl,[l(nt,{column:2,bordered:""},{default:a(()=>[l(E,{label:"工作流名称"},{default:a(()=>[y(h(s.name),1)]),_:1}),l(E,{label:"工作流编码"},{default:a(()=>[y(h(s.code),1)]),_:1}),l(E,{label:"分类"},{default:a(()=>[y(h(Re(s.category)),1)]),_:1}),l(E,{label:"版本"},{default:a(()=>[y("v"+h(s.version),1)]),_:1}),l(E,{label:"节点数量"},{default:a(()=>[y(h(s.nodes.length),1)]),_:1}),l(E,{label:"连线数量"},{default:a(()=>[y(h(s.edges.length),1)]),_:1}),l(E,{label:"描述",span:2},{default:a(()=>[y(h(s.description||"-"),1)]),_:1})]),_:1})]),i("div",cl,[e[57]||(e[57]=i("h4",null,"流程图",-1)),i("div",pl,[(r(),v("svg",vl,[e[56]||(e[56]=i("defs",null,[i("marker",{id:"preview-arrow",markerWidth:"8",markerHeight:"8",refX:"7",refY:"3",orient:"auto"},[i("polygon",{points:"0 0, 8 3, 0 6",fill:"#0052d9"})])],-1)),(r(!0),v(x,null,P(s.edges,t=>(r(),v("path",{key:t.id,d:Pe(t),stroke:"#0052d9","stroke-width":"2",fill:"none","marker-end":"url(#preview-arrow)"},null,8,fl))),128)),(r(!0),v(x,null,P(s.nodes,t=>(r(),v("g",{key:t.id},[i("rect",{x:t.position.x*.25,y:t.position.y*.25,width:"50",height:"30",fill:Se(t.type),stroke:"#0052d9","stroke-width":"2",rx:"4"},null,8,ml),i("text",{x:t.position.x*.25+25,y:t.position.y*.25+20,"text-anchor":"middle","font-size":"12",fill:"white"},h(t.name.length>4?t.name.substring(0,4)+"...":t.name),9,gl)]))),128))]))])]),i("div",yl,[e[58]||(e[58]=i("h4",null,"节点列表",-1)),l(st,{data:s.nodes,columns:Ne,size:"small"},null,8,["data"])])])]),_:1},8,["visible"])])}}}),wl=yt(_l,[["__scopeId","data-v-efa96e1d"]]);export{wl as default};
