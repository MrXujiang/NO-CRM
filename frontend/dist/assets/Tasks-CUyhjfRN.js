import{C as y,d as ve,r as d,l as _e,b as n,c as R,e as T,h as a,w as t,i,t as _,p as M,o as k,y as fe,F as ge,f as ye,M as u,_ as ke}from"./index-BQBF81MK.js";const f={getAll(r,g,m){const p={};return r&&(p.status=r),g&&(p.page=g),m&&(p.pageSize=m),y.get("/tasks",{params:p})},getDueSoon(r){return y.get("/tasks/due-soon",{params:{days:r}})},create(r){return y.post("/tasks",r)},update(r,g){return y.patch(`/tasks/${r}`,g)},delete(r){return y.delete(`/tasks/${r}`)},generateMock(r){return y.post("/tasks/mock/generate",{count:r})},clearMock(){return y.delete("/tasks/mock/clear")}},he={class:"tasks-page"},be={class:"page-header"},we={class:"pagination-container"},Ce=ve({__name:"Tasks",setup(r){const g=d([]),m=d([]),p=d(!1),$=d(""),w=d(!1),K=d(!1),h=d(null),C=d(!1),B=d(10),c=d({current:1,pageSize:10,total:0}),s=d({title:"",description:"",dueDate:"",priority:"medium"}),q=[{colKey:"title",title:"任务标题",width:200},{colKey:"description",title:"描述",ellipsis:!0},{colKey:"status",title:"状态",width:100},{colKey:"priority",title:"优先级",width:100},{colKey:"dueDate",title:"截止时间",width:180},{colKey:"action",title:"操作",width:200,fixed:"right"}],E=o=>({low:"低",medium:"中",high:"高"})[o]||o,F=o=>({low:"default",medium:"warning",high:"danger"})[o]||"default",H=o=>new Date(o)<new Date,v=async()=>{p.value=!0;try{const o=await f.getAll($.value,c.value.current,c.value.pageSize);g.value=o.data,c.value.total=o.total}catch{u.error("加载任务列表失败")}finally{p.value=!1}},J=()=>{v()},D=async()=>{try{m.value=await f.getDueSoon(3),m.value.length>0?K.value=!0:u.info("暂无即将到期的任务")}catch{u.error("加载即将到期任务失败")}},O=async o=>{try{const e=o.status==="todo"?"completed":"todo";await f.update(o.id,{status:e}),u.success(e==="completed"?"任务已完成":"任务已重新打开"),v(),D()}catch{u.error("更新失败")}},Q=o=>{h.value=o,s.value={title:o.title,description:o.description||"",dueDate:o.dueDate,priority:o.priority},w.value=!0},W=async o=>{try{await f.delete(o),u.success("删除成功"),v(),D()}catch{u.error("删除失败")}},X=async()=>{if(!s.value.title||!s.value.dueDate){u.warning("请填写必填信息");return}try{h.value?(await f.update(h.value.id,s.value),u.success("更新成功")):(await f.create(s.value),u.success("创建成功")),w.value=!1,v(),D()}catch{u.error(h.value?"更新失败":"创建失败")}},Y=()=>{h.value=null,s.value={title:"",description:"",dueDate:"",priority:"medium"}},j=o=>new Date(o).toLocaleString("zh-CN"),Z=async()=>{try{const o=await f.generateMock(B.value);u.success(o.message),v()}catch{u.error("生成Mock数据失败")}},ee=async()=>{try{const o=await f.clearMock();u.success(o.message),C.value=!1,v()}catch{u.error("清空数据失败")}},te=()=>{C.value=!1};return _e(()=>{v(),D()}),(o,e)=>{const N=n("t-radio-button"),ae=n("t-radio-group"),V=n("t-icon"),S=n("t-button"),x=n("t-space"),z=n("t-tag"),U=n("t-link"),G=n("t-popconfirm"),le=n("t-table"),oe=n("t-pagination"),ne=n("t-input"),b=n("t-form-item"),ie=n("t-textarea"),se=n("t-date-picker"),P=n("t-option"),ue=n("t-select"),I=n("t-form"),A=n("t-dialog"),re=n("t-list-item-meta"),de=n("t-list-item"),me=n("t-list"),pe=n("t-empty"),ce=n("t-input-number");return k(),R("div",he,[T("div",be,[a(x,null,{default:t(()=>[a(ae,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=l=>$.value=l),onChange:v},{default:t(()=>[a(N,{value:""},{default:t(()=>[...e[13]||(e[13]=[i("全部",-1)])]),_:1}),a(N,{value:"todo"},{default:t(()=>[...e[14]||(e[14]=[i("待办",-1)])]),_:1}),a(N,{value:"completed"},{default:t(()=>[...e[15]||(e[15]=[i("已完成",-1)])]),_:1})]),_:1},8,["modelValue"]),a(S,{theme:"primary",onClick:e[1]||(e[1]=l=>w.value=!0)},{icon:t(()=>[a(V,{name:"add"})]),default:t(()=>[e[16]||(e[16]=i(" 新建任务 ",-1))]),_:1}),a(S,{theme:"warning",onClick:D},{icon:t(()=>[a(V,{name:"time"})]),default:t(()=>[i(" 即将到期 ("+_(m.value.length)+") ",1)]),_:1}),a(S,{theme:"default",onClick:e[2]||(e[2]=l=>C.value=!0)},{icon:t(()=>[a(V,{name:"tools"})]),default:t(()=>[e[17]||(e[17]=i(" Mock数据 ",-1))]),_:1})]),_:1})]),a(le,{data:g.value,columns:q,loading:p.value,"row-key":"id",stripe:"",hover:""},{status:t(({row:l})=>[a(z,{theme:l.status==="completed"?"success":"warning",variant:"light"},{default:t(()=>[i(_(l.status==="completed"?"已完成":"待办"),1)]),_:2},1032,["theme"])]),priority:t(({row:l})=>[a(z,{theme:F(l.priority),variant:"light"},{default:t(()=>[i(_(E(l.priority)),1)]),_:2},1032,["theme"])]),dueDate:t(({row:l})=>[T("span",{class:fe({overdue:H(l.dueDate)&&l.status==="todo"})},_(j(l.dueDate)),3)]),action:t(({row:l})=>[a(x,null,{default:t(()=>[l.status==="todo"?(k(),M(U,{key:0,theme:"success",onClick:L=>O(l)},{default:t(()=>[...e[18]||(e[18]=[i(" 完成 ",-1)])]),_:1},8,["onClick"])):(k(),M(U,{key:1,theme:"primary",onClick:L=>O(l)},{default:t(()=>[...e[19]||(e[19]=[i(" 重新打开 ",-1)])]),_:1},8,["onClick"])),a(U,{theme:"primary",onClick:L=>Q(l)},{default:t(()=>[...e[20]||(e[20]=[i("编辑",-1)])]),_:1},8,["onClick"]),a(G,{content:"确定删除此任务吗？",onConfirm:L=>W(l.id)},{default:t(()=>[a(U,{theme:"danger"},{default:t(()=>[...e[21]||(e[21]=[i("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),T("div",we,[a(oe,{modelValue:c.value.current,"onUpdate:modelValue":e[3]||(e[3]=l=>c.value.current=l),pageSize:c.value.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>c.value.pageSize=l),total:c.value.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",onChange:J},null,8,["modelValue","pageSize","total"])]),a(A,{visible:w.value,"onUpdate:visible":e[9]||(e[9]=l=>w.value=l),header:h.value?"编辑任务":"新建任务",width:"600px",onConfirm:X,onClose:Y},{default:t(()=>[a(I,{data:s.value,"label-align":"right","label-width":100},{default:t(()=>[a(b,{label:"任务标题",name:"title"},{default:t(()=>[a(ne,{modelValue:s.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.title=l),placeholder:"请输入任务标题"},null,8,["modelValue"])]),_:1}),a(b,{label:"任务描述",name:"description"},{default:t(()=>[a(ie,{modelValue:s.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.description=l),placeholder:"请输入任务描述（可选）",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),a(b,{label:"截止时间",name:"dueDate"},{default:t(()=>[a(se,{modelValue:s.value.dueDate,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.dueDate=l),"enable-time-picker":"",placeholder:"请选择截止时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(b,{label:"优先级",name:"priority"},{default:t(()=>[a(ue,{modelValue:s.value.priority,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.priority=l),placeholder:"请选择优先级"},{default:t(()=>[a(P,{value:"low",label:"低"}),a(P,{value:"medium",label:"中"}),a(P,{value:"high",label:"高"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header"]),a(A,{visible:K.value,"onUpdate:visible":e[10]||(e[10]=l=>K.value=l),header:"即将到期的任务",width:"700px",footer:!1},{default:t(()=>[m.value.length>0?(k(),M(me,{key:0,split:!0},{default:t(()=>[(k(!0),R(ge,null,ye(m.value,l=>(k(),M(de,{key:l.id},{action:t(()=>[a(z,{theme:"warning"},{default:t(()=>[i(_(j(l.dueDate)),1)]),_:2},1024)]),default:t(()=>[a(re,null,{title:t(()=>[a(x,null,{default:t(()=>[T("span",null,_(l.title),1),a(z,{theme:F(l.priority),variant:"light",size:"small"},{default:t(()=>[i(_(E(l.priority)),1)]),_:2},1032,["theme"])]),_:2},1024)]),description:t(()=>[i(_(l.description||"无描述"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(k(),M(pe,{key:1,description:"暂无即将到期的任务"}))]),_:1},8,["visible"]),a(A,{visible:C.value,"onUpdate:visible":e[12]||(e[12]=l=>C.value=l),header:"Mock数据管理",width:"500px",onConfirm:te},{default:t(()=>[a(I,{"label-align":"right","label-width":100},{default:t(()=>[a(b,{label:"生成数量"},{default:t(()=>[a(ce,{modelValue:B.value,"onUpdate:modelValue":e[11]||(e[11]=l=>B.value=l),min:1,max:100,placeholder:"请输入生成数量"},null,8,["modelValue"])]),_:1}),a(b,{label:"操作"},{default:t(()=>[a(x,null,{default:t(()=>[a(S,{theme:"primary",onClick:Z},{icon:t(()=>[a(V,{name:"add"})]),default:t(()=>[e[22]||(e[22]=i(" 生成Mock数据 ",-1))]),_:1}),a(G,{content:"确定清空所有任务数据吗？此操作不可恢复！",onConfirm:ee},{default:t(()=>[a(S,{theme:"danger"},{icon:t(()=>[a(V,{name:"delete"})]),default:t(()=>[e[23]||(e[23]=i(" 清空所有数据 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])])}}}),Ve=ke(Ce,[["__scopeId","data-v-4707ad9c"]]);export{Ve as default};
