import{p as v}from"./product-DNZ9AZQV.js";import{p as le}from"./product-category-BH--ZeEQ.js";import{d as ae,r,D as j,l as oe,b as n,c as K,e as E,h as l,w as a,i as c,o as p,F,f as N,p as V,t as ne,M as s,_ as ue}from"./index-BQBF81MK.js";const re={class:"products-page"},ie={class:"page-header"},de=ae({__name:"Products",setup(se){const b=r(!1),z=r([]),w=r([]),k=r(""),C=r(""),_=r(!1),f=r(!1),x=r(10),g=r("create"),o=j({name:"",code:"",category:"",price:0,unit:"",minQuantity:1,description:""}),i=j({current:1,pageSize:10,total:0}),$=[{colKey:"code",title:"产品代码",width:120},{colKey:"name",title:"产品名称",width:200},{colKey:"category",title:"分类",width:120},{colKey:"price",title:"价格",width:120,cell:"price"},{colKey:"unit",title:"单位",width:80},{colKey:"salesCount",title:"销量",width:100},{colKey:"status",title:"状态",width:100,cell:"status"},{colKey:"action",title:"操作",width:150,cell:"action",fixed:"right"}],O={name:[{required:!0,message:"请输入产品名称"}],code:[{required:!0,message:"请输入产品代码"}],category:[{required:!0,message:"请选择分类"}],price:[{required:!0,message:"请输入价格"}],unit:[{required:!0,message:"请输入单位"}],minQuantity:[{required:!0,message:"请输入最小数量"}]},m=async()=>{b.value=!0;try{const u=await v.getAll(k.value||void 0,C.value||void 0,i.current,i.pageSize);z.value=u.data,i.total=u.total}catch{s.error("加载产品列表失败")}finally{b.value=!1}},R=async()=>{try{w.value=await le.getActive()}catch(u){console.error("加载分类失败:",u)}},G=()=>{m()},I=()=>{g.value="create",Object.assign(o,{name:"",code:"",category:"",price:0,unit:"",minQuantity:1,description:""}),f.value=!0},L=u=>{g.value="edit",Object.assign(o,u),f.value=!0},T=async()=>{try{g.value==="create"?(await v.create(o),s.success("创建成功")):(await v.update(o.id,o),s.success("更新成功")),f.value=!1,m()}catch{s.error("保存失败")}},H=async u=>{try{await v.delete(u),s.success("删除成功"),m()}catch{s.error("删除失败")}},J=async()=>{try{const u=await v.generateMock(x.value);s.success(u.message),_.value=!1,m()}catch{s.error("生成Mock数据失败")}};return oe(()=>{R(),m()}),(u,e)=>{const q=n("t-icon"),D=n("t-button"),U=n("t-space"),y=n("t-option"),h=n("t-select"),W=n("t-card"),Q=n("t-tag"),P=n("t-link"),X=n("t-popconfirm"),Y=n("t-table"),Z=n("t-pagination"),M=n("t-input-number"),d=n("t-form-item"),A=n("t-form"),B=n("t-dialog"),S=n("t-input"),ee=n("t-textarea");return p(),K("div",re,[E("div",ie,[e[17]||(e[17]=E("h2",null,"产品管理",-1)),l(U,null,{default:a(()=>[l(D,{theme:"default",onClick:e[0]||(e[0]=t=>_.value=!0)},{icon:a(()=>[l(q,{name:"data"})]),default:a(()=>[e[15]||(e[15]=c(" Mock数据 ",-1))]),_:1}),l(D,{theme:"primary",onClick:I},{icon:a(()=>[l(q,{name:"add"})]),default:a(()=>[e[16]||(e[16]=c(" 新建产品 ",-1))]),_:1})]),_:1})]),l(W,{class:"filter-card"},{default:a(()=>[l(U,null,{default:a(()=>[l(h,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),placeholder:"产品分类",clearable:"",style:{width:"200px"},onChange:m},{default:a(()=>[(p(!0),K(F,null,N(w.value,t=>(p(),V(y,{key:t.id,value:t.name,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),l(h,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),placeholder:"状态",clearable:"",style:{width:"120px"},onChange:m},{default:a(()=>[l(y,{value:"active",label:"启用"}),l(y,{value:"inactive",label:"停用"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(Y,{data:z.value,columns:$,loading:b.value,"row-key":"id",stripe:"",hover:"",class:"data-table"},{status:a(({row:t})=>[t.status==="active"?(p(),V(Q,{key:0,theme:"success"},{default:a(()=>[...e[18]||(e[18]=[c("启用",-1)])]),_:1})):(p(),V(Q,{key:1,theme:"default"},{default:a(()=>[...e[19]||(e[19]=[c("停用",-1)])]),_:1}))]),price:a(({row:t})=>[c(" ¥"+ne(t.price.toFixed(2)),1)]),action:a(({row:t})=>[l(U,null,{default:a(()=>[l(P,{theme:"primary",onClick:te=>L(t)},{default:a(()=>[...e[20]||(e[20]=[c("编辑",-1)])]),_:1},8,["onClick"]),l(X,{content:"确认删除此产品？",onConfirm:te=>H(t.id)},{default:a(()=>[l(P,{theme:"danger"},{default:a(()=>[...e[21]||(e[21]=[c("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["data","loading"]),l(Z,{modelValue:i.current,"onUpdate:modelValue":e[3]||(e[3]=t=>i.current=t),pageSize:i.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>i.pageSize=t),total:i.total,"show-jumper":"",onChange:G},null,8,["modelValue","pageSize","total"]),l(B,{visible:_.value,"onUpdate:visible":e[6]||(e[6]=t=>_.value=t),header:"生成 Mock 数据",onConfirm:J},{default:a(()=>[l(A,null,{default:a(()=>[l(d,{label:"生成数量"},{default:a(()=>[l(M,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t),min:1,max:100},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"]),l(B,{visible:f.value,"onUpdate:visible":e[14]||(e[14]=t=>f.value=t),header:g.value==="create"?"新建产品":"编辑产品",width:"600px",onConfirm:T},{default:a(()=>[l(A,{ref:"formRef",data:o,rules:O,"label-width":"100px"},{default:a(()=>[l(d,{label:"产品名称",name:"name"},{default:a(()=>[l(S,{modelValue:o.name,"onUpdate:modelValue":e[7]||(e[7]=t=>o.name=t),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"产品代码",name:"code"},{default:a(()=>[l(S,{modelValue:o.code,"onUpdate:modelValue":e[8]||(e[8]=t=>o.code=t),placeholder:"请输入产品代码"},null,8,["modelValue"])]),_:1}),l(d,{label:"产品分类",name:"category"},{default:a(()=>[l(h,{modelValue:o.category,"onUpdate:modelValue":e[9]||(e[9]=t=>o.category=t),placeholder:"请选择分类"},{default:a(()=>[(p(!0),K(F,null,N(w.value,t=>(p(),V(y,{key:t.id,value:t.name,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"价格",name:"price"},{default:a(()=>[l(M,{modelValue:o.price,"onUpdate:modelValue":e[10]||(e[10]=t=>o.price=t),min:0},null,8,["modelValue"])]),_:1}),l(d,{label:"单位",name:"unit"},{default:a(()=>[l(S,{modelValue:o.unit,"onUpdate:modelValue":e[11]||(e[11]=t=>o.unit=t),placeholder:"如:年、月、套"},null,8,["modelValue"])]),_:1}),l(d,{label:"最小数量",name:"minQuantity"},{default:a(()=>[l(M,{modelValue:o.minQuantity,"onUpdate:modelValue":e[12]||(e[12]=t=>o.minQuantity=t),min:1},null,8,["modelValue"])]),_:1}),l(d,{label:"产品描述"},{default:a(()=>[l(ee,{modelValue:o.description,"onUpdate:modelValue":e[13]||(e[13]=t=>o.description=t),maxlength:500},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header"])])}}}),fe=ue(de,[["__scopeId","data-v-7b1cb472"]]);export{fe as default};
