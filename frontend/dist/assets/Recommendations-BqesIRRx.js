import{C as y,d as J,r as h,D as K,l as Q,b as a,c as k,e as l,h as e,w as o,i,t as s,m as X,o as z,F as Y,f as Z,p as tt,M as v,H as U,_ as et}from"./index-BQBF81MK.js";const F={async calculate(c=.1,r=.5){return y.post("/recommendations/calculate",{minSupport:c,minConfidence:r})},async getAll(c=1,r=20){const b={page:c,pageSize:r};return y.get("/recommendations",{params:b})},async getStatistics(){return y.get("/recommendations/statistics")},async getForProduct(c,r=5){return y.get(`/recommendations/product/${c}`,{params:{limit:r}})},async getForOrder(c,r=5){return y.get(`/recommendations/order/${c}`,{params:{limit:r}})},async clear(){return y.delete("/recommendations/clear")}},ot={class:"recommendations-page"},nt={class:"page-header"},lt={style:{"margin-left":"8px"}},at={key:0},st={style:{"text-align":"center"}},it={style:{"font-size":"24px",color:"#0052d9"}},rt={style:{"text-align":"center"}},dt={style:{"font-size":"24px",color:"#00a870"}},ct={style:{"text-align":"center"}},ut={style:{"font-size":"24px",color:"#e37318"}},pt={style:{"text-align":"center"}},mt={style:{"font-size":"24px",color:"#0594fa"}},_t={style:{"margin-top":"20px"}},ft={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},gt={style:{flex:"1"}},yt={style:{"margin-left":"10px"}},vt={style:{display:"flex",gap:"10px"}},xt=J({__name:"Recommendations",setup(c){const r=h(!1),b=h([]),C=h(!1),V=h(!1),p=h(null),m=K({minSupport:.1,minConfidence:.5}),u=K({current:1,pageSize:20,total:0}),N=[{colKey:"reason",title:"推荐规则",minWidth:250,ellipsis:!0},{colKey:"confidence",title:"置信度",width:180,cell:"confidence"},{colKey:"support",title:"支持度",width:100,cell:"support"},{colKey:"lift",title:"提升度",width:100,cell:"lift"},{colKey:"coOccurrence",title:"共现/总订单",width:130,cell:"coOccurrence"},{colKey:"calculatedAt",title:"计算时间",width:160,ellipsis:!0}],S=async()=>{r.value=!0;try{const d=await F.getAll(u.current,u.pageSize);b.value=d.data,u.total=d.total}catch{v.error("加载推荐规则失败")}finally{r.value=!1}},P=()=>{S()},R=async()=>{const d=U.confirm({header:"确认计算",body:"计算推荐规则将分析所有历史订单数据，可能需要一些时间。确认开始计算？",confirmBtn:"开始计算",onConfirm:async()=>{var t,f;try{const _=await F.calculate(m.minSupport,m.minConfidence);v.success(_.message),C.value=!1,S(),d.hide()}catch(_){v.error(((f=(t=_.response)==null?void 0:t.data)==null?void 0:f.message)||"计算失败"),d.hide()}}})},L=()=>{U.confirm({header:"确认清空",body:"确定要清空所有推荐规则吗？此操作不可恢复。",confirmBtn:"确认清空",theme:"danger",onConfirm:async({e:d})=>{try{const t=await F.clear();v.success(t.message),S()}catch{v.error("清空失败")}}})},M=async()=>{try{p.value=await F.getStatistics(),V.value=!0}catch{v.error("加载统计数据失败")}};return Q(()=>{S()}),(d,t)=>{const f=a("t-icon"),_=a("t-button"),$=a("t-space"),B=a("t-alert"),g=a("t-card"),j=a("t-progress"),x=a("t-tag"),T=a("t-table"),E=a("t-pagination"),A=a("t-input-number"),O=a("t-form-item"),H=a("t-form"),D=a("t-dialog"),w=a("t-col"),I=a("t-row"),W=a("t-list-item"),q=a("t-list");return z(),k("div",ot,[l("div",nt,[t[10]||(t[10]=l("h2",null,"智能推荐管理",-1)),e($,null,{default:o(()=>[e(_,{theme:"primary",onClick:t[0]||(t[0]=n=>C.value=!0)},{icon:o(()=>[e(f,{name:"chart-bubble"})]),default:o(()=>[t[7]||(t[7]=i(" 计算推荐规则 ",-1))]),_:1}),e(_,{theme:"default",onClick:M},{icon:o(()=>[e(f,{name:"chart-pie"})]),default:o(()=>[t[8]||(t[8]=i(" 查看统计 ",-1))]),_:1}),e(_,{theme:"danger",onClick:L},{icon:o(()=>[e(f,{name:"delete"})]),default:o(()=>[t[9]||(t[9]=i(" 清空规则 ",-1))]),_:1})]),_:1})]),e(g,{class:"info-card"},{default:o(()=>[e(B,{theme:"info",message:"智能推荐基于 Apriori 关联规则算法，分析历史订单数据，为每个产品计算关联推荐产品。"}),t[11]||(t[11]=l("div",{style:{"margin-top":"10px",color:"#666","font-size":"14px"}},[l("p",null,[l("strong",null,"支持度 (Support):"),i(" 同时购买两个产品的订单占总订单的比例")]),l("p",null,[l("strong",null,"置信度 (Confidence):"),i(" 购买产品A的客户中，也购买产品B的比例")]),l("p",null,[l("strong",null,"提升度 (Lift):"),i(" 购买产品A对购买产品B的提升程度，大于1表示正相关")])],-1))]),_:1}),e(g,{style:{"margin-top":"16px"}},{default:o(()=>[e(T,{data:b.value,columns:N,loading:r.value,"row-key":"id",stripe:"",hover:"","table-layout":"auto"},{confidence:o(({row:n})=>[e(j,{percentage:n.confidence*100,theme:n.confidence>=.7?"success":n.confidence>=.5?"warning":"default",size:"small"},null,8,["percentage","theme"]),l("span",lt,s((n.confidence*100).toFixed(1))+"%",1)]),support:o(({row:n})=>[i(s((n.support*100).toFixed(2))+"% ",1)]),lift:o(({row:n})=>[e(x,{theme:n.lift>=2?"success":n.lift>=1.5?"primary":"default"},{default:o(()=>[i(s(n.lift.toFixed(2)),1)]),_:2},1032,["theme"])]),coOccurrence:o(({row:n})=>[i(s(n.coOccurrence)+" / "+s(n.totalOrders),1)]),_:1},8,["data","loading"]),e(E,{modelValue:u.current,"onUpdate:modelValue":t[1]||(t[1]=n=>u.current=n),pageSize:u.pageSize,"onUpdate:pageSize":t[2]||(t[2]=n=>u.pageSize=n),total:u.total,pageSizeOptions:[10,20,50,100],"show-jumper":"",style:{"margin-top":"16px"},onChange:P},null,8,["modelValue","pageSize","total"])]),_:1}),e(D,{visible:C.value,"onUpdate:visible":t[5]||(t[5]=n=>C.value=n),header:"计算推荐规则",onConfirm:R},{default:o(()=>[e(H,{data:m,"label-width":"120px"},{default:o(()=>[e(O,{label:"最小支持度"},{default:o(()=>[e(A,{modelValue:m.minSupport,"onUpdate:modelValue":t[3]||(t[3]=n=>m.minSupport=n),min:0,max:1,step:.05,tips:"同时购买两个产品的订单占总订单的最小比例"},null,8,["modelValue"])]),_:1}),e(O,{label:"最小置信度"},{default:o(()=>[e(A,{modelValue:m.minConfidence,"onUpdate:modelValue":t[4]||(t[4]=n=>m.minConfidence=n),min:0,max:1,step:.05,tips:"购买产品A的客户中，也购买产品B的最小比例"},null,8,["modelValue"])]),_:1}),e(B,{theme:"warning",message:"计算推荐规则需要足够的历史订单数据支撑，建议至少有50条订单记录"})]),_:1},8,["data"])]),_:1},8,["visible"]),e(D,{visible:V.value,"onUpdate:visible":t[6]||(t[6]=n=>V.value=n),header:"推荐统计",width:"700px"},{default:o(()=>[p.value?(z(),k("div",at,[e(I,{gutter:16},{default:o(()=>[e(w,{span:6},{default:o(()=>[e(g,null,{default:o(()=>[l("div",st,[l("div",it,s(p.value.total),1),t[12]||(t[12]=l("div",{style:{color:"#888"}},"推荐规则数",-1))])]),_:1})]),_:1}),e(w,{span:6},{default:o(()=>[e(g,null,{default:o(()=>[l("div",rt,[l("div",dt,s((p.value.avgConfidence*100).toFixed(1))+"%",1),t[13]||(t[13]=l("div",{style:{color:"#888"}},"平均置信度",-1))])]),_:1})]),_:1}),e(w,{span:6},{default:o(()=>[e(g,null,{default:o(()=>[l("div",ct,[l("div",ut,s((p.value.avgSupport*100).toFixed(2))+"%",1),t[14]||(t[14]=l("div",{style:{color:"#888"}},"平均支持度",-1))])]),_:1})]),_:1}),e(w,{span:6},{default:o(()=>[e(g,null,{default:o(()=>[l("div",pt,[l("div",mt,s(p.value.avgLift.toFixed(2)),1),t[15]||(t[15]=l("div",{style:{color:"#888"}},"平均提升度",-1))])]),_:1})]),_:1})]),_:1}),l("div",_t,[t[16]||(t[16]=l("h4",null,"Top 10 推荐规则",-1)),e(q,{stripe:""},{default:o(()=>[(z(!0),k(Y,null,Z(p.value.topRecommendations,(n,G)=>(z(),tt(W,{key:n.id},{default:o(()=>[l("div",ft,[l("div",gt,[e(x,{theme:"primary",size:"small"},{default:o(()=>[i(s(G+1),1)]),_:2},1024),l("span",yt,s(n.reason),1)]),l("div",vt,[e(x,null,{default:o(()=>[i("置信度: "+s((n.confidence*100).toFixed(1))+"%",1)]),_:2},1024),e(x,null,{default:o(()=>[i("支持度: "+s((n.support*100).toFixed(2))+"%",1)]),_:2},1024),e(x,null,{default:o(()=>[i("提升度: "+s(n.lift.toFixed(2)),1)]),_:2},1024)])])]),_:2},1024))),128))]),_:1})])])):X("",!0)]),_:1},8,["visible"])])}}}),bt=et(xt,[["__scopeId","data-v-13921c93"]]);export{bt as default};
